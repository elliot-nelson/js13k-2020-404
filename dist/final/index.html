<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t={t:0,i:.5*Math.PI,s:Math.PI,h:1.5*Math.PI,o:2*Math.PI,l:32,u:32,p:0,M:1,m:2,g:3,q:9};class i{constructor(t,i){this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=i,this.v=this.canvas.getContext("2d")}}const s={x:0,y:0,w:32,R:32},h={x:0,y:32,w:16,R:22},e={x:0,y:54,w:236,R:6},r={x:0,y:76,w:109,R:9},a={x:109,y:76,w:109,R:9},l={x:0,y:85,w:6,R:7},n={x:6,y:85,w:6,R:7},o={x:0,y:92,w:32,R:32},f={x:32,y:92,w:32,R:32},y={x:0,y:231,w:32,R:32},c={x:0,y:466,w:32,R:32},w={x:32,y:466,w:32,R:32},u={x:64,y:466,w:32,R:32},x={x:128,y:466,w:32,R:32},M={x:160,y:466,w:32,R:32},p={x:192,y:466,w:32,R:32},d={x:224,y:466,w:32,R:32};class T{static L(t,i,s,h){t.drawImage(i.T,s-i.anchor.x,h-i.anchor.y)}static A(t,i,s,h){t.v.drawImage(i.T,s.x-i.anchor.x-h.x+t.I.D,s.y-i.anchor.y-h.y+t.I.k)}static B(t,i,s,h){t.strokeStyle="rgba(0, 255, 0, 0.5)",t.strokeRect(s-i.anchor.x+i.O[0].x,h-i.anchor.y+i.O[0].y,i.O[1].x-i.O[0].x,i.O[1].y-i.O[0].y)}static H(t,i,s,h){i.C&&(t.strokeStyle="rgba(255, 0, 0, 0.7)",t.strokeRect(s-i.anchor.x+i.C[0].x,h-i.anchor.y+i.C[0].y,i.C[1].x-i.C[0].x,i.C[1].y-i.C[0].y))}static N(t,i,s){let h=t.O[1].x-t.O[0].x,e=t.O[1].y-t.O[0].y,r=(h>e?h:e)/2;return{x:i-t.anchor.x+(t.O[0].x+t.O[1].x)/2,y:s-t.anchor.y+(t.O[0].y+t.O[1].y)/2,r:r}}static S(t,i,s){return this.P(t.anchor,t.O,i,s)}static U(t,i,s){return this.P(t.anchor,t.C,i,s)}static P(t,i,s,h){return{x:s,y:h,_:[{x:i[0].x-t.x,y:i[0].y-t.y},{x:i[1].x-t.x,y:i[0].y-t.y},{x:i[1].x-t.x,y:i[1].y-t.y},{x:i[0].x-t.x,y:i[1].y-t.y}]}}}const g=.7071067811865475;class b{constructor(t){this.F=t,this.map=[],this.map[88]=m.V.W,this.map[90]=m.V.j,this.map[67]=m.V.G,this.map[32]=m.V.$,this.map[38]=m.V.K,this.map[40]=m.V.Y,this.map[37]=m.V.J,this.map[39]=m.V.X,this.map[87]=m.V.K,this.map[83]=m.V.Y,this.map[65]=m.V.J,this.map[68]=m.V.X,this.map[27]=m.V.Z,this.map[77]=m.V.tt,this.map[70]=m.V.it,this.map[80]=m.V.it,this.st=[{x:0,y:0,ht:0},{x:0,y:-1,ht:1},{x:0,y:1,ht:1},{x:0,y:0,ht:0},{x:-1,y:0,ht:1},{x:-g,y:-g,ht:1},{x:-g,y:g,ht:1},{x:-1,y:0,ht:1},{x:1,y:0,ht:1},{x:g,y:-g,ht:1},{x:g,y:g,ht:1},{x:1,y:0,ht:1},{x:0,y:0,ht:0},{x:0,y:-1,ht:1},{x:0,y:1,ht:1},{x:0,y:0,ht:0}],this.et=[],this.e()}async init(){window.addEventListener("keydown",t=>{let i=this.map[t.keyCode];console.log(t.keyCode),i&&(this.et[i]=!0)}),window.addEventListener("keyup",t=>{let i=this.map[t.keyCode];i&&(this.et[i]=!1)})}a(){let t=(this.et[m.V.K]?1:0)+(this.et[m.V.Y]?2:0)+(this.et[m.V.J]?4:0)+(this.et[m.V.X]?8:0);this.n=this.st[t]}e(){this.n=this.st[0];for(let t of Object.values(m.V))this.et[t]=!1}}const R=new class{async init(){this.canvas=document.getElementById("canvas"),this.v=this.canvas.getContext("2d"),this.resize(!0)}resize(t){let i=window.devicePixelRatio,s=this.canvas.clientWidth,h=this.canvas.clientHeight,e=s*i,r=h*i;(t||this.canvas.width!==e||this.canvas.height!==r)&&(this.canvas.width=e,this.canvas.height=r,this.scale=Math.floor(10*Math.max(e/480,r/270))/10,this.width=Math.ceil(this.canvas.width/this.scale),this.height=Math.ceil(this.canvas.height/this.scale),this.I={D:Math.floor(this.width/2),k:Math.floor(this.height/2)},this.clientWidth=s,this.clientHeight=h,this.v.rt=!1,R.canvas.style.cursor="none")}};class k{constructor(t){this.F=t,this.map=[],this.map[0]=m.V.W,this.map[2]=m.V.at,this.et=[],this.e()}async init(){return window.addEventListener("mousemove",t=>{this.nt||(this.nt={}),this.nt.D=Math.floor(t.clientX*R.width/R.clientWidth),this.nt.k=Math.floor(t.clientY*R.height/R.clientHeight)}),window.addEventListener("mouseout",()=>{this.nt=void 0}),window.addEventListener("mousedown",t=>{let i=this.map[t.button];i&&(this.et[i]=!0)}),window.addEventListener("mouseup",t=>{let i=this.map[t.button];i&&(this.et[i]=!1)}),window.addEventListener("click",t=>{t.preventDefault()}),window.addEventListener("contextmenu",t=>{let i=this.map[t.button];console.log(t.button),i&&(this.et[i]=!0),this.ot=2,t.preventDefault()}),this}a(){this.ot&&(this.ot--,0===this.ot&&(this.et[m.V.at]=!1,console.log("released")))}e(){this.nt=void 0;for(let t of Object.values(m.V))this.et[t]=!1}}class m{async init(){this.n={x:0,y:0,ht:0},this.pressed={},this.lt={},this.et={},this.ct={},this.yt=new b(this),await this.yt.init(),this.ft=new k(this),await this.ft.init()}a(){this.yt.a(),this.ft.a();for(let t of Object.values(m.V)){let i=this.ft.et[t]||this.yt.et[t];this.pressed[t]=!this.et[t]&&i,this.lt[t]=this.et[t]&&!i,this.pressed[t]?this.ct[t]=1:this.et[t]&&i&&this.ct[t]++,this.et[t]=i}this.nt=this.ft.nt,this.n=this.yt.n}wt(t){}xt(t){}}m.V={K:11,Y:12,J:13,X:14,W:21,at:30,j:22,G:23,$:24,Z:96,tt:97,it:98};const v={ut:(()=>{let t=[];for(let i=0;i<=360;i++)t[i]=2*Math.PI*i/360;return t})(),dt(t){let i=Math.sqrt(t.x*t.x+t.y*t.y);return 0===i?{x:0,y:0,ht:0}:{x:t.x/i,y:t.y/i,ht:i}},pt:(t,i)=>v.dt({x:i.x-t.x,y:i.y-t.y}),Mt:(t,i)=>({x:Math.cos(t),y:Math.sin(t),ht:i||1}),gt(t){let i=Math.atan2(t.y,t.x);return i<0&&(i+=v.ut[360]),i},qt:t=>({x:t.x*(t.ht||1),y:t.y*(t.ht||1)}),bt:(t,i)=>([t,i]=[v.qt(t),v.qt(i)],t.x*i.x+t.y*i.y),Et(...t){let i={x:0,y:0,ht:1};for(let s of t)i.x+=s.x*(s.ht||1),i.y+=s.y*(s.ht||1);return i},vt(t,i,s){for(i>s&&([i,s]=[s,i]);t>=s+v.ut[360];)t-=v.ut[360];for(;t<=i-v.ut[360];)t+=v.ut[360];return t>=i&&t<s},Rt(t,i,s,h){for(console.log([t,i,s,h].map(t=>360*t/(2*Math.PI))),t>i&&([t,i]=[i,t]),s>h&&([s,h]=[h,s]);h>=i+v.ut[360];)h-=v.ut[360],s-=v.ut[360];for(;s<=t-v.ut[360];)s+=v.ut[360],h+=v.ut[360];const e=[Math.max(t,s),Math.min(i,h)];return console.log([t,i,s,h,...e].map(t=>360*t/(2*Math.PI))),e[0]>e[1]?void 0:e},Lt:i=>({Tt:i.x/t.l|0,r:i.y/t.u|0}),At:i=>({x:i.Tt*t.l,y:i.r*t.u}),Dt:t=>({D:t.x+R.I.D-L.kt.It.x,k:t.y+R.I.k-L.kt.It.y}),Bt:(t,i,s)=>t<i?i:t>s?s:t,Ot(t,i){let s,h,e=i-t;return 0===e?(h=NaN,s=1/0):e>0?(h=1/e,s=(1-(t-Math.floor(t)))*h):(h=-1/e,s=(t-Math.floor(t))*h),{next:s,step:h}},*Ht(i,s){let h=i.x/t.l,e=i.y/t.u,r=s.x/t.l,a=s.y/t.u,l=Math.abs(Math.floor(h)-Math.floor(r))+Math.abs(Math.floor(e)-Math.floor(a));if(yield{Tt:0|h,r:0|e,ht:0},l>1){let t=h,i=e,s=0,n=Math.sign(r-h),o=Math.sign(a-e),f=v.Ot(h,r),y=v.Ot(e,a);for(let h=0;h<l-1;h++)f.next<y.next?(t+=n,s+=n,f.next+=f.step):(i+=o,s+=o,y.next+=y.step),yield{Tt:0|t,r:0|i,ht:s}}l>0&&(yield{Tt:0|r,r:0|a,ht:1})},*Ct(t,i){yield*v.Ht(t,v.Et(t,i))},*Nt(i){for(let s=Math.floor(i[0].y/t.u);s*t.u<i[1].y;s++)for(let h=Math.floor(i[0].x/t.l);h*t.l<i[1].x;h++)yield{Tt:h,r:s}},*St(t,i,s){let h=[{x:Math.min(t.x,i.x)-s,y:Math.min(t.y,i.y)-s},{x:Math.max(t.x,i.x)+s,y:Math.max(t.y,i.y)+s}];yield*v.Nt(h)},*Pt(t,i,s){yield*v.St(t,{x:t.x+i.x,y:t.y+i.y},s)},Ut(t,i,s,h){if(Math.max(t.x,i.x)+s<h[0].x||Math.min(t.x,i.x)-s>h[1].x||Math.max(t.y,i.y)+s<h[0].y||Math.min(t.y,i.y)-s>h[1].y)return;let e=i.x-t.x,r=i.y-t.y,a=0===e?0:1/e,l=0===r?0:1/r,n=1/0,o=1/0;if(t.x-s<h[0].x&&i.x+s>h[0].x){let i=(h[0].x-s-t.x)*a;if(i>=0&&i<=1){let s=r*i+t.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*i+t.x,y:s,_t:i,Ft:-1,Wt:0,zt:h[0].x,Vt:s}}n=h[0].x}if(t.x+s>h[1].x&&i.x-s<h[1].x){let l=(t.x-(h[1].x+s))*-a;if(l>=0&&l<=1){let s=r*l+i.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*l+t.x,y:s,_t:l,Ft:1,Wt:0,zt:h[1].x,Vt:s}}n=h[1].x}if(t.y-s<h[0].y&&i.y+s>h[0].y){let i=(h[0].y-s-t.y)*l;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:r*i+t.y,_t:i,Ft:0,Wt:-1,zt:s,Vt:h[0].y}}o=h[0].y}if(t.y+s>h[1].y&&i.y-s<h[1].y){let i=(t.y-(h[1].y+s))*-l;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:r*i+t.y,_t:i,Ft:0,Wt:1,zt:s,Vt:h[0].y}}o=h[1].y}if(n===1/0&&o===1/0)return;n!==1/0&&o===1/0&&(o=r>0?h[1].y:h[0].y),o!==1/0&&n===1/0&&(n=e>0?h[1].x:h[0].x);let f=1/s,y=Math.sqrt(e*e+r*r),c=n-t.x,w=o-t.y,u=Math.sqrt(c*c+w*w),x=Math.acos((c*e+w*r)/(y*u));if(u<s)return;if(0===x){let i=(u-s)/y;if(i>1||i<0)return;let h=i*e+t.x,a=i*r+t.y,l=c/u,f=w/u;return isNaN(h)?void 0:{x:h,y:a,_t:i,Ft:l,Wt:f,zt:n,Vt:o}}let M=Math.sin(x),p=M*u*f;if(Math.abs(p)>1)return;let d=Math.PI-Math.asin(p),T=Math.PI-x-d,g=s*Math.sin(T)/M/y;if(g>1||g<0)return;let b=g*e+t.x,R=g*r+i.y,k=(b-n)*f,m=(R-o)*f;return isNaN(b)?void 0:{x:b,y:R,_t:g,Ft:k,Wt:m,zt:n,Vt:o}},jt(t,i,s,h,e,r){[s,r]=[v.qt(s),v.qt(r)];let a={x:t.x+s.x,y:t.y+s.y},l={x:h.x+r.x,y:h.y+r.y},n=v.pt(a,l);if(n.ht<i+e)return{Ft:n.x,Wt:n.y,ht:i+e-n.ht}},Gt(t,i){let s=v.$t(t[0].length,t.length,100);console.log(s[0][0]);let h=[{...i,Kt:0}];for(;h.length>0;){let{Tt:i,r:e,Kt:r}=h.shift();s[e][i]<=r||(s[e][i]=r++,t[e][i+1]&&s[e][i+1]>r&&h.push({Tt:i+1,r:e,Kt:r}),t[e][i-1]&&s[e][i-1]>r&&h.push({Tt:i-1,r:e,Kt:r}),t[e+1][i]&&s[e+1][i]>r&&h.push({Tt:i,r:e+1,Kt:r}),t[e-1][i]&&s[e-1][i]>r&&h.push({Tt:i,r:e-1,Kt:r}))}return console.log(["---",s,"---"]),s},$t(t,i,s){let h="function"==typeof s?s:()=>s;return Array.from({length:i},()=>Array.from({length:t},h))},Yt:(t,i)=>!!L.Jt.Jt[i][t]},W={Xt:(t,i,s,h)=>()=>{let e=(t>>>=0)+(i>>>=0)|0;return t=i^i>>>9,i=(s>>>=0)+(s<<3)|0,e=e+(h=1+(h>>>=0)|0)|0,s=(s=s<<21|s>>>11)+e|0,(e>>>0)/4294967296},Zt(t){let i,s;for(i=0,s=1779033703^t.length;i<t.length;i++)s=Math.imul(s^t.charCodeAt(i),3432918353),s=s<<13|s>>>19;return()=>(s=Math.imul(s^s>>>16,2246822507),s=Math.imul(s^s>>>13,3266489909),(s^=s>>>16)>>>0)},seed(t){let i=this.Zt(t),s=this.Xt(i(),i(),i(),i());return(t,i)=>"number"==typeof t&&"number"==typeof i?Math.floor(s()*(i-t))+t:s()}},N=[{Tt:0,r:0},{Tt:0,r:-1},{Tt:0,r:1},{Tt:-1,r:0},{Tt:1,r:0}],S=[{Tt:0,r:-1},{Tt:0,r:1},{Tt:-1,r:0},{Tt:1,r:0}],F={Qt:(t,i,s)=>N.filter(h=>{let[e,r]=[i+h.Tt,s+h.r];return r>=0&&r<t.length&&e>=0&&e<t[0].length&&!t[r][e]}),ti(t,i,s,h,e,r){let a=2*i(0,(s[1].Tt-h)/2)+1,l=2*i(0,(s[1].r-e)/2)+1,n=void 0;for(let i=0;i<e;i++)for(let s=0;s<h;s++)if(t[l+i][a+s]&&(r=n=t[l+i][a+s]),1===t[l+i][a+s])return;if(!(n&&i()>.01)){for(let i=0;i<e;i++)for(let s=0;s<h;s++)t[l+i][a+s]=r;return{Tt:a,r:l,width:h,height:e,ii:r}}},si(t,i,s,h,e){let r=[{Tt:s,r:h}];for(t[h][s]=e;r.length>0;){let s=i()<.25?i(0,r.length):r.length-1,h=r[s];s!==r.length-1&&(r.splice(s,1),r.push(h));let a=S.filter(i=>4===F.Qt(t,h.Tt+i.Tt,h.r+i.r).length);if(0===a.length)r.splice(r.indexOf(h),1);else{let s=a[i(0,a.length)];t[h.r+s.r][h.Tt+s.Tt]=e,r.push({Tt:h.Tt+s.Tt,r:h.r+s.r}),console.log(r)}}},hi(t,i){let s=[],h=[];for(let i=1;i<t.length-1;i++)for(let e=1;e<t.length-1;e++){let r,a,[l,n,o,f]=[t[i-1][e],t[i+1][e],t[i][e-1],t[i][e+1]];l&&n&&l!==n?(r=l,a=n):o&&f&&o!==f&&(r=o,a=f),r&&a&&(r>a&&([r,a]=[a,r]),s.push({Tt:e,r:i,ei:r,ri:a}),h.push(r,a))}let e=[...new Set(h)].map(t=>[t]);for(console.log(e);s.length>0;){let h=i(0,s.length),r=s.splice(h,1)[0];t[r.r][r.Tt]=r.ei;let a=e.find(t=>t.includes(r.ei)),l=e.find(t=>t.includes(r.ri));i()>.2&&(s=s.filter(t=>!(a.includes(t.ei)&&l.includes(t.ri)||l.includes(t.ei)&&a.includes(t.ri)))),a!==l&&(e.splice(e.indexOf(l),1),a.push(...l))}},ai(t,i){let s=[];for(let i=0;i<t.length;i++)for(let h=0;h<t[0].length;h++)t[i][h]&&F.Qt(t,h,i).length>=3&&s.push({Tt:h,r:i});for(;s.length>0;){let h=i(0,s.length),e=s.splice(h,1)[0];if(i()<.45){let s=S.filter(i=>F.Qt(t,e.Tt+i.Tt,e.r+i.r).length<=2&&e.Tt+i.Tt>=0&&e.Tt+i.Tt<t[0].length&&e.r+i.r>=0&&e.r+i.r<t.length),h=s[i(0,s.length)];if(h){t[e.r+h.r][e.Tt+h.Tt]=t[e.r][e.Tt];continue}}i()>.05&&(t[e.r][e.Tt]=0,S.forEach(i=>{let[h,r]=[e.Tt+i.Tt,e.r+i.r];t[r][h]&&F.Qt(t,h,r).length>=3&&h>=0&&h<t[0].length&&r>=0&&r<t.length&&s.push({Tt:h,r:r})}))}},ni:t=>t.reduce((t,i)=>(t[i.ii]=t[i.ii]||[],t[i.ii].push(i),t),{}),oi(i,s){let h=v.$t(i[0].length,i.length,()=>(s()<.1?t.g:t.m)+256);for(let s=0;s<h.length;s++)for(let e=0;e<h[0].length;e++)if(i[s][e]){let r=(i[s-1][e-1]?0:256)+(i[s-1][e]?0:128)+(i[s-1][e+1]?0:64)+(i[s][e-1]?0:32)+(i[s][e]?0:16)+(i[s][e+1]?0:8)+(i[s+1][e-1]?0:4)+(i[s+1][e]?0:2)+(i[s+1][e+1]?0:1);h[s][e]=(r<<4)+t.p}return h},li(t){let i=v.$t(99,99,0),s=W.seed(t),h=1,e=F.ti(i,s,[{Tt:0,r:0},{Tt:99,r:99}],11,9,h++);console.log(e);let r=[e];for(let t=0;t<100;t++){let t=2*s(3,4)+1,a=2*s(3,4)+1;e=F.ti(i,s,[{Tt:0,r:0},{Tt:99,r:99}],t,a,h),e&&r.push(e),e&&e.ii===h&&h++}for(let t=0;t<100;t++){let t=2*s(2,4)+1,a=2*s(2,4)+1;e=F.ti(i,s,[{Tt:0,r:0},{Tt:99,r:99}],t,a,h),e&&r.push(e),e&&e.ii===h&&h++}for(let t=0;t<100;t++){let t=2*s(1,4)+1,a=2*s(1,4)+1;e=F.ti(i,s,[{Tt:0,r:0},{Tt:99,r:99}],t,a,h),e&&r.push(e),e&&e.ii===h&&h++}for(let t=1;t<99;t+=2)for(let e=1;e<99;e+=2)5===F.Qt(i,e,t).length&&F.si(i,s,e,t,h++);F.hi(i,s),F.ai(i,s);let a=v.Gt(i,r[0]);return{Jt:i,ci:F.oi(i,s),yi:s,fi:this.ni(r),wi:a}}},K={32:3,44:3,46:3,73:2},z={async init(){this.default=T.font.T,this.xi=this.ui(this.default,t=>{let i=t.createLinearGradient(0,0,0,this.default.height);return i.addColorStop(0,"rgba(240,134,51,1)"),i.addColorStop(1,"rgba(250,220,74,1)"),i}),this.di=this.ui(this.default,"rgba(240, 240, 255, 0.25)")},pi(t,i,s,h,e=this.default,r=1){i=i.toUpperCase();for(let a=0;a<i.length;a++){let l=i.charCodeAt(a);t.drawImage(e,4*(l-32),0,3,5,s,h,3*r,5*r),s+=(K[l]||4)*r}},Mi(t,i,s,h,e=this.default,r=1){i=i.toUpperCase(),s-=this.mi(i,r),this.pi(t,i,s,h,e,r)},gi(t,i,s,h,e,r,a=this.default,l=1){let n=s,o=h,f=i.toUpperCase().split(" ");for(let i of f){let h=this.mi(i,l);n+h-s>e&&(n=s,o+=7*l),this.pi(t,i,n,o,a,l),n+=h+K[32]}},mi:(t,i)=>t.split("").reduce((t,i)=>t+(K[i.charCodeAt(0)]||4),0)*i,ui(t,s){let h=new i(t.width,t.height);return h.v.fillStyle="function"==typeof s?s(h.v):s,h.v.fillRect(0,0,t.width,t.height),console.log(t.width,t.height,s,h),h.v.globalCompositeOperation="destination-in",h.v.drawImage(t,0,0),h.canvas}},_={qi(t,i){for(let s of v.Ht(t.It,i.It))if(!v.Yt(s.Tt,s.r))return!1;return!0}},j={IDLE:101,bi:102,Ei:103,vi:104,Ri:105,Li:106,W:201,at:202,apply(t){for(let i of t)i.Ti&&i.Ti()}};class D{constructor(){this.It={x:0,y:0},this.Ai={x:0,y:0},this.Di={x:0,y:-1,ht:0},this.Ii=100,this.ki=[],this.Bi=11,this.Oi=.5}Ti(){switch(this.state){case j.IDLE:_.qi(this,L.Hi)&&(this.state=j.Ei);break;case j.Ei:let t=v.pt(this.It,L.Hi.It);t.ht=v.Bt(t.ht,0,1),this.Ai={x:t.x*t.ht,y:t.y*t.ht};break;case j.Li:this.Ai={x:0,y:0,ht:0},this.Ci||(this.Ci=15),this.Ci--,this.Ci<1&&(this.Ni=!0);break;default:this.state=j.IDLE}}Si(t){this.state===j.Li?T.A(t,T.Pi,this.It,L.kt.It):T.A(t,T.Ui,this.It,L.kt.It)}}class O{constructor(t,i){this.It={...t},this.angle=i,this._i=v.ut[70],this.range=55}Ti(){if(this._t=(this._t||0)+1,3===this._t){let t=L.entities.filter(t=>t instanceof D);for(let i of t){let t=v.pt(this.It,i.It);if(t.ht>=this.range+i.Bi)continue;let s=v.pt(this.It,{x:i.It.x-t.y*i.Bi,y:i.It.y+t.x*i.Bi}),h=v.pt(this.It,{x:i.It.x+t.y*i.Bi,y:i.It.y-t.x*i.Bi}),e=[v.gt(s),v.gt(h)];if(!v.Rt(e[0],e[1],this.angle-this._i/2,this.angle+this._i/2))continue;let r=[];v.Et(this.It,v.Mt(e[0],t.ht));for(let i of v.Ct(this.It,v.Mt(e[0],t.ht)))if(!v.Yt(i.Tt,i.r)){r.push(i);break}for(let i of v.Ct(this.It,v.Mt(e[1],t.ht)))if(!v.Yt(i.Tt,i.r)){r.push(i);break}r.length<2&&i.ki.push({Fi:25,Wi:t})}}this._t>6&&(this.Ni=!0)}Si(t){let i=v.Dt(this.It);t.v.beginPath(),t.v.arc(i.D,i.k,this.range,this.angle-this._i/2,this.angle+this._i/2),t.v.lineTo(i.D,i.k),t.v.closePath(),t.v.fillStyle="rgba(255, 0, 0, 0.5)",t.v.fill()}}class V{constructor(){this.It={x:0,y:0},this.Ai={x:0,y:0},this.Di={x:0,y:-1,ht:0},this.Ii=100,this.ki=[],this.Bi=12,this.zi=4,this.Vi=4,this.Oi=3}Ti(){switch(this.state){case j.vi:this.ji(1),L.input.pressed[m.V.W]&&(0===this.zi?this.reload():this.xi()),L.input.pressed[m.V.at]&&this.reload();break;case j.W:this.ji(1),--this.f<=0&&(this.state=j.vi);break;case j.at:this.ji(2.5),--this.f<=0&&(this.state=j.vi);break;default:this.state=j.vi,this.f=0}}ji(t){L.Gi()&&(this.Di=v.pt(this.It,L.Gi()));let i=L.input.n.x*L.input.n.ht*1.8*t,s=L.input.n.y*L.input.n.ht*1.8*t;this.Ai.x=(this.Ai.x+i)/2,this.Ai.y=(this.Ai.y+s)/2}Si(i){T.A(i,T.Hi,this.It,L.kt.It),i.v.strokeStyle="rgba(255, 255, 64, 0.3)",i.v.beginPath();let s=L.Dt(this.It);i.v.arc(s.D,s.k,t.q,0,2*Math.PI),i.v.setLineDash([2,1]),i.v.stroke(),i.v.setLineDash([])}xi(){this.state=j.W,this.f=6,this.zi--;let t=v.gt(this.Di);L.entities.push(new O(this.It,t)),this.Ai=v.dt(this.Di),this.Ai.ht=1}reload(){this.state=j.at,this.f=12,this.zi=this.Vi}}const $={Si(t){}},A={apply(t){let i=t.filter(t=>t.It&&t.Ai&&!t.Ni);for(let t=0;t<5;t++){for(let t=0;t<i.length-1;t++)for(let s=t+1;s<i.length;s++)this.$i(i[t],i[s]);for(let t of i)this.Ki(t)}for(let t of i)t.It.x+=t.Ai.x,t.It.y+=t.Ai.y},$i(t,i){let s=v.jt(t.It,t.Bi,t.Ai,i.It,i.Bi,i.Ai);if(s){let h=v.dt(t.Ai).ht+i.Oi,e=v.dt(i.Ai).ht+t.Oi;t.Ai.x-=s.Ft*s.ht*h/(h+e),t.Ai.y-=s.Wt*s.ht*h/(h+e),i.Ai.x+=s.Ft*s.ht*e/(h+e),i.Ai.y+=s.Wt*s.ht*e/(h+e)}},Ki(i){for(let s of v.Pt(i.It,i.Ai,t.q))if(!v.Yt(s.Tt,s.r)){let h=[v.At(s),v.At({Tt:s.Tt+1,r:s.r+1})],e=v.Ut(i.It,{x:i.It.x+i.Ai.x,y:i.It.y+i.Ai.y},t.q,h);e&&(0===e.Ft?i.Ai.y=e.y-i.It.y:0===e.Wt?i.Ai.x=e.x-i.It.x:(i.Ai.x+=e.Ft,i.Ai.y+=e.Wt))}}},E={apply(t){for(let i of t)if("number"==typeof i.Ii){if(i.ki.length>0){for(let t of i.ki)i.Ii-=t.Fi,t.Wi.ht=10,i.Ai=v.Et(i.Ai,t.Wi);i.ki=[]}i.Ii<=0&&(i.state=j.Li)}}},L=new class{constructor(){}async init(){R.init(),this.input=new m,await this.input.init(),this.Jt=F.li("apples"),this.kt={It:{x:1,y:1}},await class{static async init(){this.images={},T.font=await this.Yi("sprites.png",e),T.Hi=await this.Yi("sprites.png",y),T.Ji=await this.Yi("sprites.png",s),T.Ui=await this.Yi("sprites.png",o),T.Pi=await this.Yi("sprites.png",f),T.Xi=await this.Yi("sprites.png",h),T.Zi=await this.Yi("sprites.png",l),T.Qi=await this.Yi("sprites.png",n),T.ts=await this.Yi("sprites.png",r),T.ss=await this.Yi("sprites.png",a),T.ci=[],T.ci[t.p]=await this.Yi("sprites.png",u),T.ci[t.m]=await this.Yi("sprites.png",c),T.ci[t.g]=await this.Yi("sprites.png",w);let i=await this.Yi("sprites.png",x),g=await this.Yi("sprites.png",M),b=(await this.Yi("sprites.png",p),await this.Yi("sprites.png",d));T.hs=[],T.hs[32]=T.hs[288]=T.hs[36]=T.hs[292]=i,T.hs[8]=T.hs[72]=T.hs[9]=T.hs[73]=this.es(this.rs(i.T,t.s)),T.hs[128]=T.hs[384]=T.hs[192]=T.hs[448]=this.es(this.rs(i.T,t.i)),T.hs[8]=this.es(this.rs(i.T,t.s)),T.hs[2]=this.es(this.rs(i.T,t.h)),T.hs[160]=T.hs[416]=T.hs[224]=T.hs[480]=T.hs[228]=T.hs[164]=T.hs[228]=T.hs[484]=g,T.hs[136]=T.hs[200]=T.hs[392]=T.hs[456]=T.hs[137]=T.hs[201]=T.hs[457]=T.hs[393]=this.es(this.rs(g.T,t.i)),T.hs[10]=T.hs[11]=T.hs[14]=T.hs[15]=T.hs[74]=T.hs[75]=T.hs[78]=T.hs[79]=this.es(this.rs(g.T,t.s)),T.hs[34]=T.hs[35]=T.hs[38]=T.hs[39]=T.hs[290]=T.hs[291]=T.hs[294]=T.hs[295]=this.es(this.rs(g.T,t.h)),T.hs[256]=b,T.hs[64]=this.es(this.rs(b.T,t.i)),T.hs[1]=this.es(this.rs(b.T,t.s)),T.hs[4]=this.es(this.rs(b.T,t.h)),T.hs[320]=this.es(this.as(T.hs[256].T,T.hs[64].T)),T.hs[5]=this.es(this.as(T.hs[4].T,T.hs[1].T)),T.hs[260]=this.es(this.as(T.hs[256].T,T.hs[4].T)),T.hs[65]=this.es(this.as(T.hs[64].T,T.hs[1].T))}static async Yi(t,i,s){return this.es(await this.ns(t,i.x,i.y,i.w,i.R),s)}static rs(t,s){let h=new i(t.width,t.height);return h.v.translate(t.width/2,t.height/2),h.v.rotate(s),h.v.translate(-t.width/2,-t.height/2),h.v.drawImage(t,0,0),h.canvas}static as(...t){let s=new i(t[0].width,t[0].height);for(let i of t)s.v.drawImage(i,0,0);return s.canvas}static es(t,i){let s=t.width,h=t.height;return{T:t,anchor:i&&i.anchor||{x:Math.floor(s/2),y:Math.floor(h/2)},O:i&&i.O||[{x:0,y:0},{x:s,y:h}],C:i&&i.C}}static async ns(t,s,h,e,r){const a=await this.os(t),l=new i(e,r);return l.v.drawImage(a,s,h,e,r,0,0,e,r),l.canvas}static async os(t){return this.images[t]?this.images[t]:await new Promise((i,s)=>{let h=new Image;h.onload=()=>i(h),h.onerror=t=>s(t),h.src=t,this.images[t]=h})}}.init(),await z.init(),this.entities=[],this.Hi=new V,console.log(this.Jt.fi),this.Hi.It.x=(this.Jt.fi[1][0].Tt+Math.floor(this.Jt.fi[1][0].width/2))*t.l+t.l/2,this.Hi.It.y=(this.Jt.fi[1][0].r+Math.floor(this.Jt.fi[1][0].height/2))*t.l+t.l/2,this.entities.push(this.Hi)}start(){this.c=0,this.ls=!0,this.a(),this.ls=!1,window.requestAnimationFrame(()=>this.cs(1))}cs(t){this.c++,R.resize(),this.a(),this.Si(R.v),window.requestAnimationFrame(()=>this.cs(t))}a(){this.input.a(),j.apply(this.entities),E.apply(this.entities),A.apply(this.entities);let t=this.Hi.It.x-this.kt.It.x,i=this.Hi.It.y-this.kt.It.y;this.kt.It.x+=.2*t,this.kt.It.y+=.2*i,this.ys(),this.entities=this.entities.filter(t=>!t.Ni)}ys(){if(this.entities.filter(t=>t instanceof D).length<4&&Math.random()<.1){let t=this.Jt.fi[1][0].Tt+this.Jt.yi(0,this.Jt.fi[1][0].width),i=this.Jt.fi[1][0].r+this.Jt.yi(0,this.Jt.fi[1][0].height),s=new D;s.It=v.At({Tt:t,r:i}),this.entities.push(s)}}Si(t){t.setTransform(1,0,0,1,0,0),t.scale(R.scale,R.scale),t.fillStyle="rgba(48,32,48,1)",t.fillRect(0,0,R.width,R.height),this.fs(t,this.Jt),this.ws(t),z.Mi(t,[R.scale,R.width,R.height].join(", "),R.width-4,10);let i=this.input.nt;i&&(z.Mi(t,JSON.stringify(i),R.width-4,20),t.fillStyle="rgba(255, 120, 120, 1)",t.fillRect(i.D-1,i.k-1,3,3));for(let t of this.entities)t.Si(R);$.Si(R)}fs(t,i){let s=R.I.D-this.kt.It.x,h=R.I.k-this.kt.It.y;for(let e=0;e<i.ci.length;e++)for(let r=0;r<i.ci[e].length;r++){let a=32*r+s,l=32*e+h;if(a<-50||l<-50||a>500||l>500)continue;let n=T.ci[15&i.ci[e][r]];if(!n)throw new Error(`${r},${e} tile ${i.ci[e][r]}`);t.drawImage(n.T,a,l),n=T.hs[i.ci[e][r]>>4],n&&t.drawImage(n.T,a,l)}}Gi(){if(this.input.nt)return this.xs(this.input.nt)}Dt(t){return{D:t.x-this.kt.It.x+R.I.D,k:t.y-this.kt.It.y+R.I.k}}xs(t){return{x:t.D-R.I.D+this.kt.It.x,y:t.k-R.I.k+this.kt.It.y}}trace(t){if(!this.input.nt)return;let i=this.Hi;for(let s of this.entities)i!==s&&(t.v.beginPath(),t.v.strokeStyle="red",t.v.moveTo(t.I.D-this.kt.It.x+i.It.x,t.I.k-this.kt.It.y+i.It.y),t.v.lineTo(this.input.nt.D,this.input.nt.k),t.v.stroke(),this.us(i.It,this.Gi()))}us(t,i){let s="green";for(let{Tt:h,r:e}of v.Ht(t,i)){let t={x:R.I.D-this.kt.It.x,y:R.I.k-this.kt.It.y};L.Jt.Jt[e][h]||(s="red");let i="red"===s?"rgba(255, 128, 128, 0.5)":"rgba(128, 255, 128, 0.5)";if(R.v.fillStyle=i,R.v.strokeStyle=i,R.v.fillRect(32*h+t.x,32*e+t.y,32,32),R.v.strokeRect(32*h+t.x,32*e+t.y,32,32),"red"===s)break}}ws(t){let i=v.Bt(L.Hi.Ii,0,100);t.drawImage(T.ts.T,2,2),t.drawImage(T.ss.T,0,0,i+8,8,2,2,i+8,8);let s=T.Qi;for(let i=0;i<L.Hi.Vi;i++)i+1>L.Hi.zi&&(s=T.Zi),t.drawImage(s.T,15+6*i,10)}};L.init().then(()=>L.start())}();
//# sourceMappingURL=app.js.map</script><script>// Generated using https://zzfx.3d2k.com/
if (typeof AudioContext === 'undefined') { AudioContext = webkitAudioContext }
// ZzFX - Zuper Zmall Zound Zynth - Minified Version - MIT License - Copyright 2019 Frank Force
function ZZFXLib(){this.x=new AudioContext;this.r=Date.now();this.buffer=0;this.volume=.5;this.randomness=.1}ZZFXLib.prototype.z=function(b,d){var a=this.Generate(b),c;for(c in d)a[c]=d[c];return this.Z(a.volume,a.randomness,a.frequency,a.length,a.attack,a.slide,a.noise,a.modulation,a.modulationPhase)};
ZZFXLib.prototype.Z=function(b,d,a,c,e,g,h,k,l){c=void 0===c?1:c;e=void 0===e?.1:e;g=void 0===g?0:g;h=void 0===h?0:h;k=void 0===k?0:k;l=void 0===l?0:l;b*=this.volume;a*=2*Math.PI/44100;a*=1+d*(2*this.R()-1);g*=1E3*Math.PI/Math.pow(44100,2);c=0<c?44100*(10<c?10:c)|0:1;e*=c|0;k*=2*Math.PI/44100;l*=Math.PI;d=[];for(var m=0,n=0,f=0;f<c;++f)d[f]=b*Math.cos(m*a*Math.cos(n*k+l))*(f<e?f/e:1-(f-e)/(c-e)),m+=1+h*(2*this.R()-1),n+=1+h*(2*this.R()-1),a+=g;this.buffer=d;b=this.x.createBuffer(1,d.length,44100);
a=this.x.createBufferSource();b.getChannelData(0).set(d);a.buffer=b;a.connect(this.x.destination);a.start();return a};
ZZFXLib.prototype.Generate=function(b){var d=this.r;this.r=b;for(var a=9;a--;)this.R();a={};a.seed=b;a.volume=1;a.randomness=b?this.randomness:0;a.frequency=b?2E3*Math.pow(this.R(),2)|0:220;a.slide=b?parseFloat((10*Math.pow(this.R(),3)).toFixed(1)):0;a.length=b?parseFloat((.1+this.R()).toFixed(1)):1;a.attack=b?parseFloat(this.R().toFixed(2)):.1;a.noise=b?parseFloat((5*Math.pow(this.R(),3)).toFixed(1)):0;a.modulation=b?parseFloat((99*Math.pow(this.R(),5)).toFixed(1)):0;a.modulationPhase=b?parseFloat(this.R().toFixed(2)):
0;this.r=d;return a};ZZFXLib.prototype.Note=function(b,d){return b*Math.pow(2,d/12)};ZZFXLib.prototype.R=function(){this.r^=this.r<<13;this.r^=this.r>>7;this.r^=this.r<<17;return Math.abs(this.r)%1E9/1E9};var ZZFX=new ZZFXLib;</script>