<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t=.5*Math.PI,i=(Math.PI,1.5*Math.PI),s=2*Math.PI,h=32,e=32;class r{constructor(t,i){this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=i,this.t=this.canvas.getContext("2d")}}const l={i:[{x:0,y:0,w:1,s:8},{x:1,y:0,w:1,s:8},{x:2,y:0,w:1,s:8},{x:3,y:0,w:1,s:8},{x:4,y:0,w:1,s:8},{x:5,y:0,w:1,s:8},{x:6,y:0,w:1,s:8},{x:7,y:0,w:1,s:8}],h:[{x:0,y:8,w:5,s:28},{x:5,y:8,w:5,s:28},{x:10,y:8,w:5,s:28}],l:[{x:0,y:36,w:32,s:32}],font:[{x:0,y:68,w:236,s:6}],o:[{x:0,y:74,w:9,s:9}],u:[{x:0,y:83,w:109,s:9},{x:109,y:83,w:109,s:9}],M:[{x:0,y:92,w:6,s:7},{x:6,y:92,w:6,s:7}],m:[{x:0,y:99,w:32,s:32},{x:32,y:99,w:32,s:32}],page:[{x:0,y:131,w:8,s:8}],p:[{x:0,y:139,w:32,s:32},{x:32,y:139,w:32,s:32}],g:[{x:0,y:171,w:11,s:11}],q:[{x:0,y:182,w:32,s:32}],v:[{x:0,y:214,w:32,s:32}],k:[{x:0,y:246,w:17,s:17},{x:17,y:246,w:17,s:17}],A:[{x:0,y:263,w:11,s:11}],B:[{x:0,y:274,w:32,s:32},{x:32,y:274,w:32,s:32},{x:64,y:274,w:32,s:32},{x:96,y:274,w:32,s:32},{x:128,y:274,w:32,s:32},{x:160,y:274,w:32,s:32},{x:192,y:274,w:32,s:32},{x:224,y:274,w:32,s:32}],T:[{x:0,y:306,w:46,s:46},{x:46,y:306,w:46,s:46},{x:92,y:306,w:46,s:46},{x:138,y:306,w:46,s:46},{x:184,y:306,w:46,s:46},{x:230,y:306,w:46,s:46},{x:276,y:306,w:46,s:46}]};class a{static D(t,i,s,h){t.drawImage(i.S,s-i.anchor.x,h-i.anchor.y)}static N(t,i,s,h){let{C:e,R:r}=this.H(t,i,s,h);t.t.drawImage(i.S,e,r)}static H(t,i,s,h){return{C:s.x-i.anchor.x-h.x+t.I.C,R:s.y-i.anchor.y-h.y+t.I.R}}static O(t,i,s,h){t.strokeStyle="rgba(0, 255, 0, 0.5)",t.strokeRect(s-i.anchor.x+i.L[0].x,h-i.anchor.y+i.L[0].y,i.L[1].x-i.L[0].x,i.L[1].y-i.L[0].y)}static P(t,i,s,h){i.F&&(t.strokeStyle="rgba(255, 0, 0, 0.7)",t.strokeRect(s-i.anchor.x+i.F[0].x,h-i.anchor.y+i.F[0].y,i.F[1].x-i.F[0].x,i.F[1].y-i.F[0].y))}static U(t,i,s){let h=t.L[1].x-t.L[0].x,e=t.L[1].y-t.L[0].y,r=(h>e?h:e)/2;return{x:i-t.anchor.x+(t.L[0].x+t.L[1].x)/2,y:s-t.anchor.y+(t.L[0].y+t.L[1].y)/2,r:r}}static V(t,i,s){return this.W(t.anchor,t.L,i,s)}static _(t,i,s){return this.W(t.anchor,t.F,i,s)}static W(t,i,s,h){return{x:s,y:h,j:[{x:i[0].x-t.x,y:i[0].y-t.y},{x:i[1].x-t.x,y:i[0].y-t.y},{x:i[1].x-t.x,y:i[1].y-t.y},{x:i[0].x-t.x,y:i[1].y-t.y}]}}}const o=.7071067811865475;class n{constructor(t){this.G=t,this.map=[],this.map[88]=c.K.$,this.map[90]=c.K.J,this.map[67]=c.K.X,this.map[32]=c.K.Y,this.map[38]=c.K.Z,this.map[40]=c.K.tt,this.map[37]=c.K.it,this.map[39]=c.K.st,this.map[87]=c.K.Z,this.map[83]=c.K.tt,this.map[65]=c.K.it,this.map[68]=c.K.st,this.map[27]=c.K.ht,this.map[77]=c.K.et,this.map[70]=c.K.rt,this.map[80]=c.K.rt,this.at=[{x:0,y:0,lt:0},{x:0,y:-1,lt:1},{x:0,y:1,lt:1},{x:0,y:0,lt:0},{x:-1,y:0,lt:1},{x:-o,y:-o,lt:1},{x:-o,y:o,lt:1},{x:-1,y:0,lt:1},{x:1,y:0,lt:1},{x:o,y:-o,lt:1},{x:o,y:o,lt:1},{x:1,y:0,lt:1},{x:0,y:0,lt:0},{x:0,y:-1,lt:1},{x:0,y:1,lt:1},{x:0,y:0,lt:0}],this.ot=[],this.e()}async init(){window.addEventListener("keydown",t=>{let i=this.map[t.keyCode];console.log(t.keyCode),i&&(this.ot[i]=!0)}),window.addEventListener("keyup",t=>{let i=this.map[t.keyCode];i&&(this.ot[i]=!1)})}a(){let t=(this.ot[c.K.Z]?1:0)+(this.ot[c.K.tt]?2:0)+(this.ot[c.K.it]?4:0)+(this.ot[c.K.st]?8:0);this.n=this.at[t]}e(){this.n=this.at[0];for(let t of Object.values(c.K))this.ot[t]=!1}}const f=new class{async init(){this.canvas=document.getElementById("canvas"),this.t=this.canvas.getContext("2d"),this.resize(!0)}resize(t){let i=window.devicePixelRatio,s=this.canvas.clientWidth,h=this.canvas.clientHeight,e=s*i,r=h*i;(t||this.canvas.width!==e||this.canvas.height!==r)&&(this.canvas.width=e,this.canvas.height=r,this.scale=Math.floor(10*Math.max(e/480,r/270))/10,this.width=Math.ceil(this.canvas.width/this.scale),this.height=Math.ceil(this.canvas.height/this.scale),this.I={C:Math.floor(this.width/2),R:Math.floor(this.height/2)},this.clientWidth=s,this.clientHeight=h,this.t.imageSmoothingEnabled=!1,f.canvas.style.cursor="none")}};class y{constructor(t){this.G=t,this.map=[],this.map[0]=c.K.$,this.map[2]=c.K.nt,this.ot=[],this.e()}async init(){return window.addEventListener("mousemove",t=>{this.yt||(this.yt={}),this.yt.C=Math.floor(t.clientX*f.width/f.clientWidth),this.yt.R=Math.floor(t.clientY*f.height/f.clientHeight)}),window.addEventListener("mouseout",()=>{this.yt=void 0}),window.addEventListener("mousedown",t=>{let i=this.map[t.button];i&&(this.ot[i]=!0)}),window.addEventListener("mouseup",t=>{let i=this.map[t.button];i&&(this.ot[i]=!1)}),window.addEventListener("click",t=>{t.preventDefault()}),window.addEventListener("contextmenu",t=>{let i=this.map[t.button];console.log(t.button),i&&(this.ot[i]=!0),this.ct=2,t.preventDefault()}),this}a(){this.ct&&(this.ct--,0===this.ct&&(this.ot[c.K.nt]=!1,console.log("released")))}e(){this.yt=void 0;for(let t of Object.values(c.K))this.ot[t]=!1}}class c{async init(){this.n={x:0,y:0,lt:0},this.pressed={},this.ft={},this.ot={},this.xt={},this.wt=new n(this),await this.wt.init(),this.ut=new y(this),await this.ut.init()}a(){this.wt.a(),this.ut.a();for(let t of Object.values(c.K)){let i=this.ut.ot[t]||this.wt.ot[t];this.pressed[t]=!this.ot[t]&&i,this.ft[t]=this.ot[t]&&!i,this.pressed[t]?this.xt[t]=1:this.ot[t]&&i&&this.xt[t]++,this.ot[t]=i}this.yt=this.ut.yt,this.n=this.wt.n}dt(t){}Mt(t){}}c.K={Z:11,tt:12,it:13,st:14,$:21,nt:30,J:22,X:23,Y:24,ht:96,et:97,rt:98};const x={pt:(()=>{let t=[];for(let i=0;i<=360;i++)t[i]=2*Math.PI*i/360;return t})(),gt(t){let i=Math.sqrt(t.x*t.x+t.y*t.y);return 0===i?{x:0,y:0,lt:0}:{x:t.x/i,y:t.y/i,lt:i}},bt:(t,i)=>x.gt({x:i.x-t.x,y:i.y-t.y}),qt:(t,i)=>({x:Math.cos(t),y:Math.sin(t),lt:i||1}),vt(t){let i=Math.atan2(t.y,t.x);return i<0&&(i+=x.pt[360]),i},Et:t=>({x:t.x*(t.lt||1),y:t.y*(t.lt||1)}),kt:(t,i)=>([t,i]=[x.Et(t),x.Et(i)],t.x*i.x+t.y*i.y),At(...t){let i={x:0,y:0,lt:1};for(let s of t)i.x+=s.x*(s.lt||1),i.y+=s.y*(s.lt||1);return i},Bt:(t,i)=>(t>i&&([t,i]=[i,t]),Math.min(i-t,s+t-i)),Tt:(h,e,r)=>(e>i&&h<=t&&(h+=s),h>i&&e<=t&&(e+=s),((e-h)*r+h+s)%s),Dt(t,i,s){for(i>s&&([i,s]=[s,i]);t>=s+x.pt[360];)t-=x.pt[360];for(;t<=i-x.pt[360];)t+=x.pt[360];return t>=i&&t<s},St(t,i,s,h){for(t>i&&([t,i]=[i,t]),s>h&&([s,h]=[h,s]);h>=i+x.pt[360];)h-=x.pt[360],s-=x.pt[360];for(;s<=t-x.pt[360];)s+=x.pt[360],h+=x.pt[360];const e=[Math.max(t,s),Math.min(i,h)];return e[0]>e[1]?void 0:e},Nt:t=>({Ct:t.x/h|0,r:t.y/e|0}),Rt:t=>({x:t.Ct*h,y:t.r*e}),Ht:t=>({C:t.x+f.I.C-T.Ot.It.x,R:t.y+f.I.R-T.Ot.It.y}),Lt:(t,i,s)=>t<i?i:t>s?s:t,Pt(t,i){let s,h,e=i-t;return 0===e?(h=NaN,s=1/0):e>0?(h=1/e,s=(1-(t-Math.floor(t)))*h):(h=-1/e,s=(t-Math.floor(t))*h),{next:s,step:h}},*Ft(t,i){let s=t.x/h,r=t.y/e,l=i.x/h,a=i.y/e,o=Math.abs(Math.floor(s)-Math.floor(l))+Math.abs(Math.floor(r)-Math.floor(a));if(yield{Ct:0|s,r:0|r,lt:0},o>1){let t=s,i=r,h=0,e=Math.sign(l-s),n=Math.sign(a-r),f=x.Pt(s,l),y=x.Pt(r,a);for(let s=0;s<o-1;s++)f.next<y.next?(t+=e,h+=e,f.next+=f.step):(i+=n,h+=n,y.next+=y.step),yield{Ct:0|t,r:0|i,lt:h}}o>0&&(yield{Ct:0|l,r:0|a,lt:1})},*Ut(t,i){yield*x.Ft(t,x.At(t,i))},*zt(t){for(let i=Math.floor(t[0].y/e);i*e<t[1].y;i++)for(let s=Math.floor(t[0].x/h);s*h<t[1].x;s++)yield{Ct:s,r:i}},*Vt(t,i,s){let h=[{x:Math.min(t.x,i.x)-s,y:Math.min(t.y,i.y)-s},{x:Math.max(t.x,i.x)+s,y:Math.max(t.y,i.y)+s}];yield*x.zt(h)},*Wt(t,i,s){yield*x.Vt(t,{x:t.x+i.x,y:t.y+i.y},s)},_t(t,i,s,h){if(Math.max(t.x,i.x)+s<h[0].x||Math.min(t.x,i.x)-s>h[1].x||Math.max(t.y,i.y)+s<h[0].y||Math.min(t.y,i.y)-s>h[1].y)return;let e=i.x-t.x,r=i.y-t.y,l=0===e?0:1/e,a=0===r?0:1/r,o=1/0,n=1/0;if(t.x-s<h[0].x&&i.x+s>h[0].x){let i=(h[0].x-s-t.x)*l;if(i>=0&&i<=1){let s=r*i+t.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*i+t.x,y:s,jt:i,Gt:-1,$t:0,Kt:h[0].x,Jt:s}}o=h[0].x}if(t.x+s>h[1].x&&i.x-s<h[1].x){let a=(t.x-(h[1].x+s))*-l;if(a>=0&&a<=1){let s=r*a+i.y;if(s>=h[0].y&&s<=h[1].y)return{x:e*a+t.x,y:s,jt:a,Gt:1,$t:0,Kt:h[1].x,Jt:s}}o=h[1].x}if(t.y-s<h[0].y&&i.y+s>h[0].y){let i=(h[0].y-s-t.y)*a;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:r*i+t.y,jt:i,Gt:0,$t:-1,Kt:s,Jt:h[0].y}}n=h[0].y}if(t.y+s>h[1].y&&i.y-s<h[1].y){let i=(t.y-(h[1].y+s))*-a;if(i>=0&&i<=1){let s=e*i+t.x;if(s>=h[0].x&&s<=h[1].x)return{x:s,y:r*i+t.y,jt:i,Gt:0,$t:1,Kt:s,Jt:h[0].y}}n=h[1].y}if(o===1/0&&n===1/0)return;o!==1/0&&n===1/0&&(n=r>0?h[1].y:h[0].y),n!==1/0&&o===1/0&&(o=e>0?h[1].x:h[0].x);let f=1/s,y=Math.sqrt(e*e+r*r),c=o-t.x,x=n-t.y,w=Math.sqrt(c*c+x*x),u=Math.acos((c*e+x*r)/(y*w));if(w<s)return;if(0===u){let i=(w-s)/y;if(i>1||i<0)return;let h=i*e+t.x,l=i*r+t.y,a=c/w,f=x/w;return isNaN(h)?void 0:{x:h,y:l,jt:i,Gt:a,$t:f,Kt:o,Jt:n}}let M=Math.sin(u),d=M*w*f;if(Math.abs(d)>1)return;let C=Math.PI-Math.asin(d),b=Math.PI-u-C,g=s*Math.sin(b)/M/y;if(g>1||g<0)return;let p=g*e+t.x,k=g*r+i.y,m=(p-o)*f,v=(k-n)*f;return isNaN(p)?void 0:{x:p,y:k,jt:g,Gt:m,$t:v,Kt:o,Jt:n}},Xt(t,i,s,h,e,r){[s,r]=[x.Et(s),x.Et(r)];let l={x:t.x+s.x,y:t.y+s.y},a={x:h.x+r.x,y:h.y+r.y},o=x.bt(l,a);if(o.lt<i+e)return{Gt:o.x,$t:o.y,lt:i+e-o.lt}},Yt(t,i,s=1/0){let h=x.Zt(t[0].length,t.length,1/0),e=[{...i,Qt:0}];for(;e.length>0;){let{Ct:i,r:r,Qt:l}=e.shift();h[r][i]<=l||(h[r][i]=l++,h[r][i]>=s||(t[r][i+1]&&h[r][i+1]>l&&e.push({Ct:i+1,r:r,Qt:l}),t[r][i-1]&&h[r][i-1]>l&&e.push({Ct:i-1,r:r,Qt:l}),t[r+1][i]&&h[r+1][i]>l&&e.push({Ct:i,r:r+1,Qt:l}),t[r-1][i]&&h[r-1][i]>l&&e.push({Ct:i,r:r-1,Qt:l})))}return h},Zt(t,i,s){let h="function"==typeof s?s:()=>s;return Array.from({length:i},()=>Array.from({length:t},h))},ti(t,i){if(T.ii){let s=T.ii.si;if(t<s.Ct||i<s.r||t>=s.Ct+s.width||i>=s.r+s.height)return!1}return!!T.hi.hi[i][t]}},w={ei:(t,i,s,h)=>()=>{let e=(t>>>=0)+(i>>>=0)|0;return t=i^i>>>9,i=(s>>>=0)+(s<<3)|0,e=e+(h=1+(h>>>=0)|0)|0,s=(s=s<<21|s>>>11)+e|0,(e>>>0)/4294967296},ri(t){let i,s;for(i=0,s=1779033703^t.length;i<t.length;i++)s=Math.imul(s^t.charCodeAt(i),3432918353),s=s<<13|s>>>19;return()=>(s=Math.imul(s^s>>>16,2246822507),s=Math.imul(s^s>>>13,3266489909),(s^=s>>>16)>>>0)},seed(t){let i=this.ri(t),s=this.ei(i(),i(),i(),i());return(t,i)=>"number"==typeof t&&"number"==typeof i?Math.floor(s()*(i-t))+t:s()}},u=[{Ct:0,r:0},{Ct:0,r:-1},{Ct:0,r:1},{Ct:-1,r:0},{Ct:1,r:0}],M=[{Ct:0,r:-1},{Ct:0,r:1},{Ct:-1,r:0},{Ct:1,r:0}],d={ai:(t,i,s)=>u.filter(h=>{let[e,r]=[i+h.Ct,s+h.r];return r>=0&&r<t.length&&e>=0&&e<t[0].length&&!t[r][e]}),li(t,i,s,h,e,r){let l=2*i(0,(s[1].Ct-h)/2)+1,a=2*i(0,(s[1].r-e)/2)+1,o=void 0;for(let i=0;i<e;i++)for(let s=0;s<h;s++){if(t[a+i][l+s])return;if(t[a+i][l+s]&&(r=o=t[a+i][l+s]),1===t[a+i][l+s])return}if(!(o&&i()>.01)){for(let i=0;i<e;i++)for(let s=0;s<h;s++)t[a+i][l+s]=r;return r>1&&(h>=5&&e>=5&&(t[a+i(1,e-2)][l+i(1,h-2)]=0),h>=7&&e>=7&&(t[a+i(1,e-2)][l+i(1,h-2)]=0),h>=9&&e>=9&&(t[a+i(1,e-2)][l+i(1,h-2)]=0)),{Ct:l,r:a,width:h,height:e,oi:r}}},ni(t,i,s,h,e){let r=[{Ct:s,r:h}];for(t[h][s]=e;r.length>0;){let s=i()<.25?i(0,r.length):r.length-1,h=r[s];s!==r.length-1&&(r.splice(s,1),r.push(h));let l=M.filter(i=>4===d.ai(t,h.Ct+i.Ct,h.r+i.r).length);if(0===l.length)r.splice(r.indexOf(h),1);else{let s=l[i(0,l.length)];t[h.r+s.r][h.Ct+s.Ct]=e,r.push({Ct:h.Ct+s.Ct,r:h.r+s.r}),console.log(r)}}},yi(t,i){let s=[],h=[];for(let i=1;i<t.length-1;i++)for(let e=1;e<t.length-1;e++){let r,l,a,o,[n,f,y,c]=[t[i-1][e],t[i+1][e],t[i][e-1],t[i][e+1]];n&&f&&n!==f?(r=n,l=f,a=0,o=1):y&&c&&y!==c&&(r=y,l=c,a=1,o=0),r&&l&&(r>l&&([r,l]=[l,r]),s.push({Ct:e,r:i,ci:a,fi:o,xi:r,wi:l}),h.push(r,l))}let e=[...new Set(h)].map(t=>[t]);console.log(e);let r=[];for(;s.length>0;){let h=i(0,s.length),l=s.splice(h,1)[0];t[l.r][l.Ct]=l.xi;let a=e.find(t=>t.includes(l.xi)),o=e.find(t=>t.includes(l.wi));s=s.filter(t=>{let i=a.includes(t.xi)&&o.includes(t.wi)||o.includes(t.xi)&&a.includes(t.wi);return i&&r.push(t),!i}),a!==o&&(e.splice(e.indexOf(o),1),a.push(...o))}console.log("do REMAINING",r.length);for(let s of r)x.Yt(t,{Ct:s.Ct+s.ci,r:s.r+s.fi},20)[s.r-s.fi][s.Ct-s.ci]>15&&i()<.33&&(t[s.r][s.Ct]=s.xi);console.log(r)},ui(t,i){let s=[];for(let i=0;i<t.length;i++)for(let h=0;h<t[0].length;h++)t[i][h]&&d.ai(t,h,i).length>=3&&s.push({Ct:h,r:i});for(;s.length>0;){let h=i(0,s.length),e=s.splice(h,1)[0];if(i()<.45){let s=M.filter(i=>d.ai(t,e.Ct+i.Ct,e.r+i.r).length<=2&&e.Ct+i.Ct>=0&&e.Ct+i.Ct<t[0].length&&e.r+i.r>=0&&e.r+i.r<t.length),h=s[i(0,s.length)];if(h){t[e.r+h.r][e.Ct+h.Ct]=t[e.r][e.Ct];continue}}i()>.05&&(t[e.r][e.Ct]=0,M.forEach(i=>{let[h,r]=[e.Ct+i.Ct,e.r+i.r];t[r][h]&&d.ai(t,h,r).length>=3&&h>=0&&h<t[0].length&&r>=0&&r<t.length&&s.push({Ct:h,r:r})}))}},di:t=>t.reduce((t,i)=>(t[i.oi]=t[i.oi]||[],t[i.oi].push(i),t),{}),Mi(t,i){let s=x.Zt(t[0].length,t.length,0);for(let h=0;h<s.length;h++)for(let e=0;e<s[0].length;e++)if(t[h][e]){let r=i[t[h][e]];r&&r[0]&&(r=r[0]),s[h][e]=(t[h-1][e]?0:8)|(t[h][e+1]?0:4)|(t[h+1][e]?0:2)|(t[h][e-1]?0:1),r&&(s[h][e]|=(t[h-1][e]&&h===r.r?128:0)|(t[h][e+1]&&e===r.Ct+r.width-1?64:0)|(t[h+1][e]&&h===r.r+r.height-1?32:0)|(t[h][e-1]&&e===r.Ct?16:0))}return s},mi(t,i){let s=x.Zt(t[0].length,t.length,()=>i()<.1?3:2);for(let i=0;i<s.length;i++)for(let h=0;h<s[0].length;h++)t[i][h]&&(s[i][h]=0);return s},pi(t){let i=x.Zt(99,99,0),s=w.seed(t),h=1,e=d.li(i,s,[{Ct:0,r:0},{Ct:99,r:99}],7,7,h++),r=[e];for(let t=0;t<150;t++){let t=2*s(3,4)+1,l=2*s(3,4)+1;e=d.li(i,s,[{Ct:0,r:0},{Ct:99,r:99}],t,l,h),e&&r.push(e),e&&e.oi===h&&h++}for(let t=0;t<150;t++){let t=2*s(2,4)+1,l=2*s(2,4)+1;e=d.li(i,s,[{Ct:0,r:0},{Ct:99,r:99}],t,l,h),e&&r.push(e),e&&e.oi===h&&h++}for(let t=0;t<150;t++){let t=2*s(1,4)+1,l=2*s(1,4)+1;e=d.li(i,s,[{Ct:0,r:0},{Ct:99,r:99}],t,l,h),e&&r.push(e),e&&e.oi===h&&h++}for(let t=1;t<99;t+=2)for(let e=1;e<99;e+=2)5===d.ai(i,e,t).length&&d.ni(i,s,e,t,h++);d.yi(i,s),d.ui(i,s);let l=x.Yt(i,r[0]),a=this.di(r);return{hi:i,gi:this.Mi(i,a),bi:this.mi(i,s),qi:s,vi:a,Ei:l}}},C={32:3,44:3,46:3,73:2},b={async init(){this.default=a.font.S,this.ki=this.Ai(this.default,t=>{let i=t.createLinearGradient(0,0,0,this.default.height);return i.addColorStop(0,"rgba(240,134,51,1)"),i.addColorStop(1,"rgba(250,220,74,1)"),i}),this.Bi=this.Ai(this.default,"rgba(240, 240, 255, 0.25)")},Ti(t,i,s,h,e=this.default,r=1){i=i.toUpperCase();for(let l=0;l<i.length;l++){let a=i.charCodeAt(l);t.drawImage(e,4*(a-32),0,3,5,s,h,3*r,5*r),s+=(C[a]||4)*r}},Di(t,i,s,h,e=this.default,r=1){i=i.toUpperCase(),s-=this.Si(i,r),this.Ti(t,i,s,h,e,r)},Ni(t,i,s,h,e,r,l=this.default,a=1){let o=s,n=h,f=i.toUpperCase().split(" ");for(let i of f){let h=this.Si(i,a);o+h-s>e&&(o=s,n+=7*a),this.Ti(t,i,o,n,l,a),o+=h+C[32]}},Si:(t,i)=>t.split("").reduce((t,i)=>t+(C[i.charCodeAt(0)]||4),0)*i,Ai(t,i){let s=new r(t.width,t.height);return s.t.fillStyle="function"==typeof i?i(s.t):i,s.t.fillRect(0,0,t.width,t.height),console.log(t.width,t.height,i,s),s.t.globalCompositeOperation="destination-in",s.t.drawImage(t,0,0),s.canvas}},g={Ci(t,i){for(let s of x.Ft(t.It,i.It))if(!x.ti(s.Ct,s.r))return!1;return!0}},p={IDLE:101,Ri:102,Hi:103,Ii:104,Oi:105,Li:106,$:201,nt:202,apply(t){for(let i of t)i.Pi&&i.Pi()}};class k{constructor(){this.It={x:0,y:0},this.Fi={x:0,y:0},this.Ui={x:0,y:-1,lt:0},this.zi=100,this.Vi=[],this.Wi=11,this._i=.5}Pi(){switch(this.state){case p.IDLE:g.Ci(this,T.ji)&&(this.state=p.Hi);break;case p.Hi:let t=x.bt(this.It,T.ji.It);t.lt=x.Lt(t.lt,0,1),this.Fi={x:t.x*t.lt,y:t.y*t.lt};break;case p.Li:this.Fi={x:0,y:0,lt:0},this.Gi||(this.Gi=15),this.Gi--,this.Gi<1&&(this.$i=!0);break;default:this.state=p.IDLE}}Ki(t){this.state===p.Li?a.N(t,a.Ji,this.It,T.Ot.It):a.N(t,a.Xi,this.It,T.Ot.It)}}class m{constructor(t,i){this.It={...t},this.angle=i,this.Yi=x.pt[70],this.range=55}Pi(){if(this.jt=(this.jt||0)+1,3===this.jt){let t=T.entities.filter(t=>t.zi&&!(t instanceof K));for(let i of t){let t=x.bt(this.It,i.It);if(t.lt>=this.range+i.Wi)continue;let s=x.bt(this.It,{x:i.It.x-t.y*i.Wi,y:i.It.y+t.x*i.Wi}),h=x.bt(this.It,{x:i.It.x+t.y*i.Wi,y:i.It.y-t.x*i.Wi}),e=[x.vt(s),x.vt(h)];if(!x.St(e[0],e[1],this.angle-this.Yi/2,this.angle+this.Yi/2))continue;let r=[];x.At(this.It,x.qt(e[0],t.lt));for(let i of x.Ut(this.It,x.qt(e[0],t.lt)))if(!x.ti(i.Ct,i.r)){r.push(i);break}for(let i of x.Ut(this.It,x.qt(e[1],t.lt)))if(!x.ti(i.Ct,i.r)){r.push(i);break}r.length<2&&i.Vi.push({Zi:100,Qi:t})}}this.jt>6&&(this.$i=!0)}Ki(t){let i=x.Ht(this.It);t.t.beginPath(),t.t.arc(i.C,i.R,this.range,this.angle-this.Yi/2,this.angle+this.Yi/2),t.t.lineTo(i.C,i.R),t.t.closePath(),t.t.fillStyle="rgba(255, 0, 0, 0.5)",t.t.fill()}}class v{constructor(t){this.jt=-1,this.d=t,this.z=101}Pi(){++this.jt===this.d&&(this.$i=!0)}Ki(t){for(let i=0;i<T.ji.ts;i++){let s=i*this.d/T.ji.ts,h=s-3;if(this.jt>=h){let h=Math.min(10,10+this.jt-s);t.t.globalAlpha=Math.min(1,1+(this.jt-s)/10),t.t.drawImage(a.ss.S,15+6*i,h),t.t.globalAlpha=1}}}}class K{constructor(){this.It={x:0,y:0},this.Fi={x:0,y:0},this.Ui={x:0,y:-1,lt:0},this.zi=100,this.Vi=[],this.Wi=12,this.hs=4,this.ts=4,this._i=3}Pi(){switch(this.state){case p.Ii:this.es(1),T.input.pressed[c.K.$]&&(0===this.hs?this.reload():this.ki()),T.input.pressed[c.K.nt]&&this.reload();break;case p.$:this.es(1),--this.f<=0&&(this.state=p.Ii);break;case p.nt:this.es(2.5),--this.f<=0&&(this.hs=this.ts,this.state=p.Ii);break;default:this.state=p.Ii,this.f=0}}es(t){T.rs()&&(this.Ui=x.bt(this.It,T.rs()));let i=T.input.n.x*T.input.n.lt*1.8*t,s=T.input.n.y*T.input.n.lt*1.8*t;this.Fi.x=(this.Fi.x+i)/2,this.Fi.y=(this.Fi.y+s)/2}ki(){this.state=p.$,this.f=6,this.hs--;let t=x.vt(this.Ui);T.entities.push(new m(this.It,t)),this.Fi=x.Et({...x.gt(this.Ui),lt:-1})}reload(){this.state=p.nt,this.f=12,T.entities.push(new v(this.f))}Ki(t){a.N(t,a.ji,this.It,T.Ot.It),t.t.strokeStyle="rgba(255, 255, 64, 0.3)",t.t.beginPath();let i=T.Ht(this.It);t.t.arc(i.C,i.R,9,0,2*Math.PI),t.t.setLineDash([2,1]),t.t.stroke(),t.t.setLineDash([])}}class N{constructor(){this.It={x:0,y:0},this.Fi={x:0,y:0},this.Ui={x:0,y:-1,lt:0},this.zi=100,this.Vi=[],this.Wi=3,this._i=1,this.as=!0}Pi(){switch(this.state){case p.IDLE:this.Ui=x.qt(Math.random()*Math.PI*2),this.Fi=this.Ui,this.state=p.Hi;break;case p.Hi:x.vt(x.bt(this.It,T.ji.It)),x.vt(this.Fi);let t=x.gt(this.Fi);t.lt=(t.lt+3)/2,this.Fi=x.Et(t);break;case p.Li:this.Fi={x:0,y:0,lt:0},this.Gi||(this.Gi=15),this.Gi--,this.Gi<1&&(this.$i=!0);break;default:this.state=p.IDLE}}Ki(t){if(this.state===p.Li)a.N(t,a.Ji,this.It,T.Ot.It);else{let{C:i,R:s}=a.H(t,a.k,this.It,T.Ot.It);i+=a.k.anchor.x,s+=a.k.anchor.y,t.t.save(),t.t.translate(i,s),t.t.rotate(T.c/5),a.D(t.t,a.k,0,0),t.t.restore(),a.D(t.t,a.ls,i,s)}}}const $={Ki(t){}};class R{constructor(t){this.jt=-1,this.d=16,this.z=-5,this.It=t}Pi(){++this.jt===this.d&&(this.$i=!0)}Ki(t){if(this.jt>=0&&this.jt<16){let i=Math.floor(this.jt/2);a.N(t,a.i[i],{x:this.It.x,y:this.It.y+i/2},T.Ot.It)}}}const j={apply(t){let i=t.filter(t=>t.It&&t.Fi&&!t.$i);for(let t=0;t<5;t++){for(let t=0;t<i.length-1;t++)for(let s=t+1;s<i.length;s++)this.os(i[t],i[s]);for(let t of i)this.ns(t)}for(let t of i)t.It.x+=t.Fi.x,t.It.y+=t.Fi.y},os(t,i){let s=x.Xt(t.It,t.Wi,t.Fi,i.It,i.Wi,i.Fi);if(s)if(t.as&&i.as)t.Fi.x=-s.Gt*s.lt,t.Fi.y=-s.$t*s.lt,i.Fi.x=s.Gt*s.lt,i.Fi.y=s.$t*s.lt;else{let h=x.gt(t.Fi).lt+i._i,e=x.gt(i.Fi).lt+t._i,r=t.as?.1:1,l=i.as?.1:1;t.Fi.x-=s.Gt*s.lt*r*h/(h+e),t.Fi.y-=s.$t*s.lt*r*h/(h+e),i.Fi.x+=s.Gt*s.lt*l*e/(h+e),i.Fi.y+=s.$t*s.lt*l*e/(h+e)}},ns(t){for(let i of x.Wt(t.It,t.Fi,t.Wi))if(!x.ti(i.Ct,i.r)){let s=[x.Rt(i),x.Rt({Ct:i.Ct+1,r:i.r+1})],h=x._t(t.It,{x:t.It.x+t.Fi.x,y:t.It.y+t.Fi.y},t.Wi,s);h&&(t.as?0===h.Gt?t.Fi.y=-t.Fi.y:0===h.$t?t.Fi.x=-t.Fi.x:(t.Fi.x+=h.Gt,t.Fi.y+=h.$t):0===h.Gt?t.Fi.y=h.y-t.It.y:0===h.$t?t.Fi.x=h.x-t.It.x:(t.Fi.x+=h.Gt,t.Fi.y+=h.$t))}}},E={apply(t){for(let i of t)if("number"==typeof i.zi){if(i.Vi.length>0){for(let t of i.Vi)i.zi-=t.Zi,t.Qi.lt=10,i.Fi=x.At(i.Fi,t.Qi);i.Vi=[]}i.zi<=0&&(i.state=p.Li)}}},T=new class{constructor(){}async init(){f.init(),this.input=new c,await this.input.init(),this.hi=d.pi("arkham"),this.Ot={It:{x:1,y:1}},await class{static async init(){this.images={},await this.ys("sprites.png"),a.font=this.cs(l.font[0]),a.ji=this.cs(l.q[0]),a.l=this.cs(l.l[0]),a.Xi=this.cs(l.m[0]),a.Ji=this.cs(l.m[0]),a.fs=this.cs(l.M[0]),a.ss=this.cs(l.M[1]),a.xs=this.cs(l.u[0]),a.ws=this.cs(l.u[1]),a.o=this.cs(l.o[0]),a.k=this.cs(l.k[0]),a.ls=this.cs(l.k[1]),a.page=await this.cs(l.page[0]),a.i=l.i.map(t=>this.cs(t)),a.us=l.T.slice(4,7).map(t=>this.cs(t)),a.ds=l.T.slice(1,4).map(t=>this.cs(t)),a.bi=[],a.bi[0]=this.cs(l.B[2]),a.bi[2]=this.cs(l.B[0]),a.bi[3]=this.cs(l.B[1]),a.gi=this.cs(l.T[0])}static cs(t,i){return this.Ms(this.ms("sprites.png",t.x,t.y,t.w,t.s),i)}static ps(t,i){let s=new r(t.width,t.height);return s.t.translate(t.width/2,t.height/2),s.t.rotate(i),s.t.translate(-t.width/2,-t.height/2),s.t.drawImage(t,0,0),s.canvas}static gs(...t){let i=new r(t[0].width,t[0].height);for(let s of t)i.t.drawImage(s,0,0);return i.canvas}static Ms(t,i){let s=t.width,h=t.height;return{S:t,anchor:i&&i.anchor||{x:Math.floor(s/2),y:Math.floor(h/2)},L:i&&i.L||[{x:0,y:0},{x:s,y:h}],F:i&&i.F}}static ms(t,i,s,h,e){const l=this.images[t],a=new r(h,e);return a.t.drawImage(l,i,s,h,e,0,0,h,e),a.canvas}static async ys(t){return this.images[t]?this.images[t]:await new Promise((i,s)=>{let h=new Image;h.onload=()=>i(h),h.onerror=t=>s(t),h.src=t,this.images[t]=h})}}.init(),await b.init(),this.entities=[],this.ji=new K,console.log(this.hi.vi),this.ji.It.x=(this.hi.vi[1][0].Ct+Math.floor(this.hi.vi[1][0].width/2))*h+16,this.ji.It.y=(this.hi.vi[1][0].r+Math.floor(this.hi.vi[1][0].height/2))*h+16,this.entities.push(this.ji),this.bs=[]}start(){this.c=0,this.qs=!0,this.a(),this.qs=!1,window.requestAnimationFrame(()=>this.vs(1))}vs(t){this.c++,f.resize(),this.a(),this.Ki(f.t),window.requestAnimationFrame(()=>this.vs(t))}a(){this.input.a(),p.apply(this.entities),E.apply(this.entities),j.apply(this.entities),this.entities=this.entities.filter(t=>!t.$i);let t=this.ji.It.x-this.Ot.It.x,i=this.ji.It.y-this.Ot.It.y;if(this.Ot.It.x+=.2*t,this.Ot.It.y+=.2*i,!this.ii){let t=x.Nt(T.ji.It),i=this.hi.vi[this.hi.hi[t.r][t.Ct]];i&&i.length&&(i=i[0]),i&&!this.bs.includes(i.oi)&&i.width>4&&i.height>4&&t.Ct>i.Ct&&t.r>i.r&&t.Ct<i.Ct+i.width-1&&t.r<i.r+i.height-1&&(this.ii={si:i,Es:[],ks:[{c:this.c+10,x:Math.floor(Math.random()*(32*i.width))+32*i.Ct,y:Math.floor(Math.random()*(32*i.height))+32*i.r},{c:this.c+70,x:Math.floor(Math.random()*(32*i.width))+32*i.Ct,y:Math.floor(Math.random()*(32*i.height))+32*i.r}]},console.log("BATTLE STARTED",i))}if(this.ii)if(0===this.ii.ks.length)0===this.ii.Es.filter(t=>!t.$i).length&&(this.bs.unshift(this.ii.si.oi),this.ii=void 0,console.log("BATTLE FINISHED",this.As));else if(this.c>=this.ii.ks[0].c){let t=this.ii.ks.shift(),i=new N;i.It={x:t.x,y:t.y},this.entities.push(i),this.ii.Es.push(i)}let s=Math.floor(530*Math.random())-25,h=Math.floor(320*Math.random())-25,e=this.Bs({C:s,R:h});this.entities.push(new R(e))}Ts(){if(this.entities.filter(t=>t instanceof k).length<4&&Math.random()<.1){let t=this.hi.vi[1][0].Ct+this.hi.qi(0,this.hi.vi[1][0].width),i=this.hi.vi[1][0].r+this.hi.qi(0,this.hi.vi[1][0].height),s=new k;s.It=x.Rt({Ct:t,r:i}),this.entities.push(s)}}Ki(t){t.setTransform(1,0,0,1,0,0),t.scale(f.scale,f.scale),this.ii?(t.fillStyle="rgba(128,20,20,1)",t.fillRect(0,0,f.width,f.height)):(t.fillStyle="rgba(20,20,20,1)",t.fillRect(0,0,f.width,f.height));for(let t of this.entities)t.z<0&&t.Ki(f);this.Ds(t,this.hi);for(let t of this.entities)(t.z>0||!t.z)&&t.Ki(f);this.Ss(t),$.Ki(f)}Ds(t,i){let s=f.I.C-this.Ot.It.x,h=f.I.R-this.Ot.It.y,e=this.ii?this.ii.si.r:0,r=this.ii?this.ii.si.r+this.ii.si.height:i.bi.length,l=this.ii?this.ii.si.Ct:0,o=this.ii?this.ii.si.Ct+this.ii.si.width:i.bi[0].length;for(let n=e;n<r;n++)for(let e=l;e<o;e++){let r=32*e+s,l=32*n+h;if(r<-50||l<-50||r>500||l>500)continue;let o=a.bi[15&i.bi[n][e]];if(!o)throw new Error(`${e},${n} tile ${i.bi[n][e]}`);t.drawImage(o.S,r,l)}for(let n=e;n<r;n++)for(let r=l;r<o;r++){let f=32*r+s,y=32*n+h;if(!(f<-50||y<-50||f>500||y>500)&&(8&i.gi[n][r]&&t.drawImage(a.gi.S,5,5,36,4,f-2,y-2,36,4),4&i.gi[n][r]&&t.drawImage(a.gi.S,37,5,4,36,f+30,y-2,4,36),2&i.gi[n][r]&&t.drawImage(a.gi.S,5,37,36,4,f-2,y+30,36,4),1&i.gi[n][r]&&t.drawImage(a.gi.S,5,5,4,36,f-2,y-2,4,36),this.ii)){let s=this.c/8%3|0;128&i.gi[n][r]?t.drawImage(a.ds[s].S,5,0,36,9,f-2,y-7,36,9):n===e&&t.drawImage(a.us[s].S,5,0,36,5,f-2,y-7,36,5),64&i.gi[n][r]?t.drawImage(a.ds[s].S,37,5,9,41,f+30,y-2,9,41):n===e&&r===o-1&&t.drawImage(a.us[s].S,41,0,5,46,f+34,y-7,5,46),32&i.gi[n][r]&&t.drawImage(a.ds[s].S,5,37,36,9,f-2,y+30,36,9),16&i.gi[n][r]?t.drawImage(a.ds[s].S,0,5,9,41,f-7,y-2,9,41):n===e&&r===l&&t.drawImage(a.us[s].S,0,0,5,46,f-7,y-7,5,46)}}}rs(){if(this.input.yt)return this.Bs(this.input.yt)}Ht(t){return{C:t.x-this.Ot.It.x+f.I.C,R:t.y-this.Ot.It.y+f.I.R}}Bs(t){return{x:t.C-f.I.C+this.Ot.It.x,y:t.R-f.I.R+this.Ot.It.y}}Ss(t){let i=x.Lt(T.ji.zi,0,100);t.drawImage(a.xs.S,2,2),t.drawImage(a.ws.S,0,0,i+8,8,2,2,i+8,8);let s=a.ss;for(let i=0;i<T.ji.ts;i++)i+1>T.ji.hs&&(s=a.fs),t.drawImage(s.S,15+6*i,10);t.drawImage(a.page.S,f.width-39,9),b.Ti(t,"x302",f.width-30,10),b.Ti(t,String(this.c),f.width-30,f.height-28),b.Di(t,[f.scale,f.width,f.height].join(", "),f.width-4,f.height-18);let h=this.input.yt;if(h&&(b.Di(t,JSON.stringify(h),f.width-4,f.height-8),t.save(),t.translate(h.C,h.R),t.rotate(this.c/72),t.drawImage(a.o.S,-a.o.anchor.x,-a.o.anchor.y),t.restore()),!this.Ns){let t=["rgba(20, 20, 20)","rgba(20, 20, 20)","rgba(32, 32, 32)","rgba(32, 32, 32)","rgba(64, 6, 6)","rgba(64, 6, 6)","rgba(128, 0, 0)","rgba(158, 32, 32)"];this.Ns=new r(100,100);for(let i=0;i<100;i++)for(let s=0;s<100;s++){let h=t[Math.floor(Math.random()*t.length)];this.Ns.t.fillStyle=h,this.Ns.t.fillRect(i,s,1,1)}this.Ns.t.Cs=.1,this.Ns.t.drawImage(this.Ns.canvas,0,0,50,100,1,0,50,100),this.Ns.t.drawImage(this.Ns.canvas,0,0,50,100,2,0,50,100),this.Ns.t.drawImage(this.Ns.canvas,0,0,50,100,3,0,50,100)}this.c}};T.init().then(()=>T.start())}();
//# sourceMappingURL=app.js.map</script><script>// Generated using https://zzfx.3d2k.com/
if (typeof AudioContext === 'undefined') { AudioContext = webkitAudioContext }
// ZzFX - Zuper Zmall Zound Zynth - Minified Version - MIT License - Copyright 2019 Frank Force
function ZZFXLib(){this.x=new AudioContext;this.r=Date.now();this.buffer=0;this.volume=.5;this.randomness=.1}ZZFXLib.prototype.z=function(b,d){var a=this.Generate(b),c;for(c in d)a[c]=d[c];return this.Z(a.volume,a.randomness,a.frequency,a.length,a.attack,a.slide,a.noise,a.modulation,a.modulationPhase)};
ZZFXLib.prototype.Z=function(b,d,a,c,e,g,h,k,l){c=void 0===c?1:c;e=void 0===e?.1:e;g=void 0===g?0:g;h=void 0===h?0:h;k=void 0===k?0:k;l=void 0===l?0:l;b*=this.volume;a*=2*Math.PI/44100;a*=1+d*(2*this.R()-1);g*=1E3*Math.PI/Math.pow(44100,2);c=0<c?44100*(10<c?10:c)|0:1;e*=c|0;k*=2*Math.PI/44100;l*=Math.PI;d=[];for(var m=0,n=0,f=0;f<c;++f)d[f]=b*Math.cos(m*a*Math.cos(n*k+l))*(f<e?f/e:1-(f-e)/(c-e)),m+=1+h*(2*this.R()-1),n+=1+h*(2*this.R()-1),a+=g;this.buffer=d;b=this.x.createBuffer(1,d.length,44100);
a=this.x.createBufferSource();b.getChannelData(0).set(d);a.buffer=b;a.connect(this.x.destination);a.start();return a};
ZZFXLib.prototype.Generate=function(b){var d=this.r;this.r=b;for(var a=9;a--;)this.R();a={};a.seed=b;a.volume=1;a.randomness=b?this.randomness:0;a.frequency=b?2E3*Math.pow(this.R(),2)|0:220;a.slide=b?parseFloat((10*Math.pow(this.R(),3)).toFixed(1)):0;a.length=b?parseFloat((.1+this.R()).toFixed(1)):1;a.attack=b?parseFloat(this.R().toFixed(2)):.1;a.noise=b?parseFloat((5*Math.pow(this.R(),3)).toFixed(1)):0;a.modulation=b?parseFloat((99*Math.pow(this.R(),5)).toFixed(1)):0;a.modulationPhase=b?parseFloat(this.R().toFixed(2)):
0;this.r=d;return a};ZZFXLib.prototype.Note=function(b,d){return b*Math.pow(2,d/12)};ZZFXLib.prototype.R=function(){this.r^=this.r<<13;this.r^=this.r>>7;this.r^=this.r<<17;return Math.abs(this.r)%1E9/1E9};var ZZFX=new ZZFXLib;</script>