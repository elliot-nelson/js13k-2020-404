<style>body,html{margin:0;padding:0;background-color:#000}div{position:absolute;top:0;bottom:0;left:0;right:0}#canvas{width:100%;height:100%}</style><div><canvas id="canvas"></canvas></div><script>!function(){"use strict";const t=20*Math.PI/360,s=70*Math.PI/360,i=90*Math.PI/360,h=(Math.PI,270*Math.PI/360),e=360*Math.PI/360,r=32,a=32;class o{constructor(t,s){this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=s,this.t=this.canvas.getContext("2d")}}const l={i:[{x:0,y:0,w:1,s:8},{x:1,y:0,w:1,s:8},{x:2,y:0,w:1,s:8},{x:3,y:0,w:1,s:8},{x:4,y:0,w:1,s:8},{x:5,y:0,w:1,s:8},{x:6,y:0,w:1,s:8},{x:7,y:0,w:1,s:8}],h:[{x:0,y:8,w:32,s:32}],font:[{x:0,y:40,w:236,s:6}],o:[{x:0,y:46,w:9,s:9}],l:[{x:0,y:55,w:109,s:9},{x:109,y:55,w:109,s:9},{x:218,y:55,w:109,s:9}],u:[{x:0,y:64,w:6,s:7},{x:6,y:64,w:6,s:7}],M:[{x:0,y:71,w:19,s:19},{x:19,y:71,w:19,s:19},{x:38,y:71,w:19,s:19},{x:57,y:71,w:19,s:19},{x:76,y:71,w:19,s:19}],m:[{x:0,y:90,w:32,s:32},{x:32,y:90,w:32,s:32}],page:[{x:0,y:122,w:8,s:8}],g:[{x:0,y:130,w:32,s:32},{x:32,y:130,w:32,s:32}],p:[{x:0,y:162,w:11,s:11}],v:[{x:0,y:173,w:32,s:32}],k:[{x:0,y:205,w:17,s:17},{x:17,y:205,w:17,s:17}],A:[{x:0,y:222,w:11,s:11}],B:[{x:0,y:233,w:19,s:19},{x:19,y:233,w:19,s:19},{x:38,y:233,w:19,s:19},{x:57,y:233,w:19,s:19},{x:76,y:233,w:19,s:19}],T:[{x:0,y:252,w:32,s:32},{x:32,y:252,w:32,s:32},{x:64,y:252,w:32,s:32},{x:96,y:252,w:32,s:32},{x:128,y:252,w:32,s:32},{x:160,y:252,w:32,s:32},{x:192,y:252,w:32,s:32},{x:224,y:252,w:32,s:32}],D:[{x:0,y:284,w:46,s:46},{x:46,y:284,w:46,s:46},{x:92,y:284,w:46,s:46},{x:138,y:284,w:46,s:46},{x:184,y:284,w:46,s:46},{x:230,y:284,w:46,s:46},{x:276,y:284,w:46,s:46}]};class n{static S(t,s,i,h){t.drawImage(s.q,i-s.e.x,h-s.e.y)}static H(t,s,i,h){let{N:e,C:r}=this.I(t,s,i,h);t.t.drawImage(s.q,e,r)}static I(t,s,i,h){return{N:i.x-s.e.x-h.x+t.R.N,C:i.y-s.e.y-h.y+t.R.C}}static O(t,s,i,h){t.strokeStyle="rgba(0, 255, 0, 0.5)",t.strokeRect(i-s.e.x+s.L[0].x,h-s.e.y+s.L[0].y,s.L[1].x-s.L[0].x,s.L[1].y-s.L[0].y)}static F(t,s,i,h){s.P&&(t.strokeStyle="rgba(255, 0, 0, 0.7)",t.strokeRect(i-s.e.x+s.P[0].x,h-s.e.y+s.P[0].y,s.P[1].x-s.P[0].x,s.P[1].y-s.P[0].y))}static U(t,s,i){let h=t.L[1].x-t.L[0].x,e=t.L[1].y-t.L[0].y,r=(h>e?h:e)/2;return{x:s-t.e.x+(t.L[0].x+t.L[1].x)/2,y:i-t.e.y+(t.L[0].y+t.L[1].y)/2,r:r}}static V(t,s,i){return this.W(t.e,t.L,s,i)}static G(t,s,i){return this.W(t.e,t.P,s,i)}static W(t,s,i,h){return{x:i,y:h,_:[{x:s[0].x-t.x,y:s[0].y-t.y},{x:s[1].x-t.x,y:s[0].y-t.y},{x:s[1].x-t.x,y:s[1].y-t.y},{x:s[0].x-t.x,y:s[1].y-t.y}]}}}const y=.7071067811865475;class f{constructor(t){this.j=t,this.map=[],this.map[88]=w.K.$,this.map[90]=w.K.J,this.map[67]=w.K.X,this.map[32]=w.K.Y,this.map[38]=w.K.Z,this.map[40]=w.K.tt,this.map[37]=w.K.it,this.map[39]=w.K.st,this.map[87]=w.K.Z,this.map[83]=w.K.tt,this.map[65]=w.K.it,this.map[68]=w.K.st,this.map[27]=w.K.ht,this.map[77]=w.K.et,this.map[70]=w.K.rt,this.map[80]=w.K.rt,this.at=[{x:0,y:0,ot:0},{x:0,y:-1,ot:1},{x:0,y:1,ot:1},{x:0,y:0,ot:0},{x:-1,y:0,ot:1},{x:-y,y:-y,ot:1},{x:-y,y:y,ot:1},{x:-1,y:0,ot:1},{x:1,y:0,ot:1},{x:y,y:-y,ot:1},{x:y,y:y,ot:1},{x:1,y:0,ot:1},{x:0,y:0,ot:0},{x:0,y:-1,ot:1},{x:0,y:1,ot:1},{x:0,y:0,ot:0}],this.lt=[],this.a()}async init(){window.addEventListener("keydown",t=>{let s=this.map[t.keyCode];console.log(t.keyCode),s&&(this.lt[s]=!0)}),window.addEventListener("keyup",t=>{let s=this.map[t.keyCode];s&&(this.lt[s]=!1)})}n(){let t=(this.lt[w.K.Z]?1:0)+(this.lt[w.K.tt]?2:0)+(this.lt[w.K.it]?4:0)+(this.lt[w.K.st]?8:0);this.f=this.at[t]}a(){this.f=this.at[0];for(let t of Object.values(w.K))this.lt[t]=!1}}const c=new class{async init(){this.canvas=document.getElementById("canvas"),this.t=this.canvas.getContext("2d"),this.resize(!0)}resize(t){let s=window.devicePixelRatio,i=this.canvas.clientWidth,h=this.canvas.clientHeight,e=i*s,r=h*s;(t||this.canvas.width!==e||this.canvas.height!==r)&&(this.canvas.width=e,this.canvas.height=r,this.scale=Math.floor(10*Math.max(e/480,r/270))/10,this.width=Math.ceil(this.canvas.width/this.scale),this.height=Math.ceil(this.canvas.height/this.scale),this.R={N:Math.floor(this.width/2),C:Math.floor(this.height/2)},this.clientWidth=i,this.clientHeight=h,this.t.imageSmoothingEnabled=!1,c.canvas.style.cursor="none")}};class x{constructor(t){this.j=t,this.map=[],this.map[0]=w.K.$,this.map[2]=w.K.nt,this.lt=[],this.a()}async init(){return window.addEventListener("mousemove",t=>{this.yt||(this.yt={}),this.yt.N=Math.floor(t.clientX*c.width/c.clientWidth),this.yt.C=Math.floor(t.clientY*c.height/c.clientHeight)}),window.addEventListener("mouseout",()=>{this.yt=void 0}),window.addEventListener("mousedown",t=>{let s=this.map[t.button];s&&(this.lt[s]=!0)}),window.addEventListener("mouseup",t=>{let s=this.map[t.button];s&&(this.lt[s]=!1)}),window.addEventListener("click",t=>{t.preventDefault()}),window.addEventListener("contextmenu",t=>{let s=this.map[t.button];console.log(t.button),s&&(this.lt[s]=!0),this.ct=2,t.preventDefault()}),this}n(){this.ct&&(this.ct--,0===this.ct&&(this.lt[w.K.nt]=!1,console.log("released")))}a(){this.yt=void 0;for(let t of Object.values(w.K))this.lt[t]=!1}}class w{async init(){this.f={x:0,y:0,ot:0},this.pressed={},this.xt={},this.lt={},this.ft={},this.wt=new f(this),await this.wt.init(),this.ut=new x(this),await this.ut.init()}n(){this.wt.n(),this.ut.n();for(let t of Object.values(w.K)){let s=this.ut.lt[t]||this.wt.lt[t];this.pressed[t]=!this.lt[t]&&s,this.xt[t]=this.lt[t]&&!s,this.pressed[t]?this.ft[t]=1:this.lt[t]&&s&&this.ft[t]++,this.lt[t]=s}this.yt=this.ut.yt,this.f=this.wt.f}Mt(t){}dt(t){}}w.K={Z:11,tt:12,it:13,st:14,$:21,nt:30,J:22,X:23,Y:24,ht:96,et:97,rt:98};const M={gt:(()=>{let t=[];for(let s=0;s<=360;s++)t[s]=2*Math.PI*s/360;return t})(),pt(t){let s=Math.sqrt(t.x*t.x+t.y*t.y);return 0===s?{x:0,y:0,ot:0}:{x:t.x/s,y:t.y/s,ot:s}},bt:(t,s)=>M.pt({x:s.x-t.x,y:s.y-t.y}),vt:(t,s)=>({x:Math.cos(t),y:Math.sin(t),ot:s||1}),kt(t){let s=Math.atan2(t.y,t.x);return s<0&&(s+=M.gt[360]),s},Et:t=>({x:t.x*(t.ot||1),y:t.y*(t.ot||1)}),At:(t,s)=>([t,s]=[M.Et(t),M.Et(s)],t.x*s.x+t.y*s.y),Bt(...t){let s={x:0,y:0,ot:1};for(let i of t)s.x+=i.x*(i.ot||1),s.y+=i.y*(i.ot||1);return s},Tt:(t,s)=>(t>s&&([t,s]=[s,t]),Math.min(s-t,e+t-s)),Dt:(t,s,r)=>(s>h&&t<=i&&(t+=e),t>h&&s<=i&&(s+=e),((s-t)*r+t+e)%e),St(t,s,i){for(s>i&&([s,i]=[i,s]);t>=i+M.gt[360];)t-=M.gt[360];for(;t<=s-M.gt[360];)t+=M.gt[360];return t>=s&&t<i},qt(t,s,i,h){for(t>s&&([t,s]=[s,t]),i>h&&([i,h]=[h,i]);h>=s+M.gt[360];)h-=M.gt[360],i-=M.gt[360];for(;i<=t-M.gt[360];)i+=M.gt[360],h+=M.gt[360];const e=[Math.max(t,i),Math.min(s,h)];return e[0]>e[1]?void 0:e},Ht:t=>({Nt:t.x/r|0,r:t.y/a|0}),Ct:t=>({x:t.Nt*r,y:t.r*a}),It:t=>({N:t.x+c.R.N-_.Ot.Rt.x,C:t.y+c.R.C-_.Ot.Rt.y}),Lt:(t,s,i)=>t<s?s:t>i?i:t,Ft(t,s){let i,h,e=s-t;return 0===e?(h=NaN,i=1/0):e>0?(h=1/e,i=(1-(t-Math.floor(t)))*h):(h=-1/e,i=(t-Math.floor(t))*h),{next:i,step:h}},*Pt(t,s){let i=t.x/r,h=t.y/a,e=s.x/r,o=s.y/a,l=Math.abs(Math.floor(i)-Math.floor(e))+Math.abs(Math.floor(h)-Math.floor(o));if(yield{Nt:0|i,r:0|h,ot:0},l>1){let t=i,s=h,r=0,a=Math.sign(e-i),n=Math.sign(o-h),y=M.Ft(i,e),f=M.Ft(h,o);for(let i=0;i<l-1;i++)y.next<f.next?(t+=a,r+=a,y.next+=y.step):(s+=n,r+=n,f.next+=f.step),yield{Nt:0|t,r:0|s,ot:r}}l>0&&(yield{Nt:0|e,r:0|o,ot:1})},*Ut(t,s){yield*M.Pt(t,M.Bt(t,s))},*Vt(t){for(let s=Math.floor(t[0].y/a);s*a<t[1].y;s++)for(let i=Math.floor(t[0].x/r);i*r<t[1].x;i++)yield{Nt:i,r:s}},*Wt(t,s,i){let h=[{x:Math.min(t.x,s.x)-i,y:Math.min(t.y,s.y)-i},{x:Math.max(t.x,s.x)+i,y:Math.max(t.y,s.y)+i}];yield*M.Vt(h)},*zt(t,s,i){yield*M.Wt(t,{x:t.x+s.x,y:t.y+s.y},i)},Gt(t,s,i,h){if(Math.max(t.x,s.x)+i<h[0].x||Math.min(t.x,s.x)-i>h[1].x||Math.max(t.y,s.y)+i<h[0].y||Math.min(t.y,s.y)-i>h[1].y)return;let e=s.x-t.x,r=s.y-t.y,a=0===e?0:1/e,o=0===r?0:1/r,l=1/0,n=1/0;if(t.x-i<h[0].x&&s.x+i>h[0].x){let s=(h[0].x-i-t.x)*a;if(s>=0&&s<=1){let i=r*s+t.y;if(i>=h[0].y&&i<=h[1].y)return{x:e*s+t.x,y:i,_t:s,jt:-1,$t:0,Kt:h[0].x,Jt:i}}l=h[0].x}if(t.x+i>h[1].x&&s.x-i<h[1].x){let o=(t.x-(h[1].x+i))*-a;if(o>=0&&o<=1){let i=r*o+s.y;if(i>=h[0].y&&i<=h[1].y)return{x:e*o+t.x,y:i,_t:o,jt:1,$t:0,Kt:h[1].x,Jt:i}}l=h[1].x}if(t.y-i<h[0].y&&s.y+i>h[0].y){let s=(h[0].y-i-t.y)*o;if(s>=0&&s<=1){let i=e*s+t.x;if(i>=h[0].x&&i<=h[1].x)return{x:i,y:r*s+t.y,_t:s,jt:0,$t:-1,Kt:i,Jt:h[0].y}}n=h[0].y}if(t.y+i>h[1].y&&s.y-i<h[1].y){let s=(t.y-(h[1].y+i))*-o;if(s>=0&&s<=1){let i=e*s+t.x;if(i>=h[0].x&&i<=h[1].x)return{x:i,y:r*s+t.y,_t:s,jt:0,$t:1,Kt:i,Jt:h[0].y}}n=h[1].y}if(l===1/0&&n===1/0)return;l!==1/0&&n===1/0&&(n=r>0?h[1].y:h[0].y),n!==1/0&&l===1/0&&(l=e>0?h[1].x:h[0].x);let y=1/i,f=Math.sqrt(e*e+r*r),c=l-t.x,x=n-t.y,w=Math.sqrt(c*c+x*x),M=Math.acos((c*e+x*r)/(f*w));if(w<i)return;if(0===M){let s=(w-i)/f;if(s>1||s<0)return;let h=s*e+t.x,a=s*r+t.y,o=c/w,y=x/w;return isNaN(h)?void 0:{x:h,y:a,_t:s,jt:o,$t:y,Kt:l,Jt:n}}let u=Math.sin(M),d=u*w*y;if(Math.abs(d)>1)return;let b=Math.PI-Math.asin(d),g=Math.PI-M-b,N=i*Math.sin(g)/u/f;if(N>1||N<0)return;let p=N*e+t.x,k=N*r+s.y,m=(p-l)*y,A=(k-n)*y;return isNaN(p)?void 0:{x:p,y:k,_t:N,jt:m,$t:A,Kt:l,Jt:n}},Xt(t,s,i,h,e,r){[i,r]=[M.Et(i),M.Et(r)];let a={x:t.x+i.x,y:t.y+i.y},o={x:h.x+r.x,y:h.y+r.y},l=M.bt(a,o);if(l.ot<s+e)return{jt:l.x,$t:l.y,ot:s+e-l.ot}},Yt(t,s,i=1/0){let h=M.Zt(t[0].length,t.length,1/0),e=[{...s,Qt:0}];for(;e.length>0;){let{Nt:s,r:r,Qt:a}=e.shift();h[r][s]<=a||(h[r][s]=a++,h[r][s]>=i||(t[r][s+1]&&h[r][s+1]>a&&e.push({Nt:s+1,r:r,Qt:a}),t[r][s-1]&&h[r][s-1]>a&&e.push({Nt:s-1,r:r,Qt:a}),t[r+1][s]&&h[r+1][s]>a&&e.push({Nt:s,r:r+1,Qt:a}),t[r-1][s]&&h[r-1][s]>a&&e.push({Nt:s,r:r-1,Qt:a})))}return h},Zt(t,s,i){let h="function"==typeof i?i:()=>i;return Array.from({length:s},()=>Array.from({length:t},h))},ti(t,s){if(_.ii){let i=_.ii.si;if(t<i.Nt||s<i.r||t>=i.Nt+i.w||s>=i.r+i.s)return!1}return!!_.hi.hi[s][t]}},u={w:34,s:24,ei:[[5,1,5,3,3],[15,3,6,4,4],[8,5,4,5,5],[28,7,3,3,6],[20,8,4,6,7],[30,11,3,3,8],[10,12,5,6,9],[4,13,1,1,1],[29,15,3,3,10],[16,19,4,4,11],[28,19,3,3,12]],ri:[40,1,1,1,30,1,1,1,1,30,1,1,1,1,7,1,1,1,1,19,4,6,1,1,1,1,1,1,1,17,4,1,1,4,1,1,1,1,1,2,17,3,1,1,1,2,1,1,1,1,1,1,1,2,16,1,1,1,1,1,1,1,2,3,6,7,1,8,2,2,1,1,1,1,1,1,2,1,1,3,1,1,3,2,1,1,8,4,1,1,1,2,5,2,1,1,1,2,1,1,1,1,1,7,1,1,8,1,1,1,2,2,1,1,1,2,5,6,1,1,1,1,7,3,2,2,1,1,1,2,1,1,4,1,3,1,1,1,1,1,1,4,1,1,1,2,2,1,1,1,1,1,4,3,1,1,3,1,1,2,1,1,1,1,1,1,1,1,1,2,2,2,1,1,1,3,1,3,1,1,3,1,1,1,1,1,1,3,1,1,1,1,4,5,2,1,5,5,1,1,1,1,4,1,1,1,1,1,1,1,1,1,2,1,1,2,5,1,6,1,1,5,1,1,1,1,3,2,2,4,4,1,1,13,1,1,1,1,3,1,1,2,2,1,1,4,1,1,21,3,1,1,2,5,21,1,1,2,2,1,1,4,1,20,1,1,1,6,3,1,1,20,1,1,1,1,1,1,1,1,1,3,1,1,20,1,1,1]},d={ai:t=>t.reduce((t,s)=>(t[s.oi]=s,t),{}),li(t,s){let i=M.Zt(t[0].length,t.length,0);console.log(t[0].length,t.length,"fook");for(let h=0;h<i.length;h++)for(let e=0;e<i[0].length;e++)if(t[h][e]){let r=s[t[h][e]];console.log(t[18][5]),console.log(h,e,r,t[h+1]),console.log(i[h]),console.log(t[h-1][e]),console.log(t[h+1][e]),console.log(t[h][e-1]),console.log(t[h][e+1]),i[h][e]=(t[h-1][e]?0:8)|(t[h][e+1]?0:4)|(t[h+1][e]?0:2)|(t[h][e-1]?0:1),r&&(i[h][e]|=(t[h-1][e]&&h===r.r?128:0)|(t[h][e+1]&&e===r.Nt+r.width-1?64:0)|(t[h+1][e]&&h===r.r+r.height-1?32:0)|(t[h][e-1]&&e===r.Nt?16:0))}return i},ni(t,s){let i=M.Zt(t[0].length,t.length,()=>s()<.1?3:2);for(let s=0;s<i.length;s++)for(let h=0;h<i[0].length;h++)t[s][h]&&(i[s][h]=0);return i},load(){let t=M.Zt(u.w,u.s,0),s=u.ei.map(t=>({Nt:t[0],r:t[1],w:t[2],s:t[3],oi:t[4]})),i=0;for(let s of u.ri)i+=s,t[i/u.w|0][i%u.w]=2;for(let i of s)for(let s=0;s<i.s;s++)for(let h=0;h<i.w;h++)t[i.r+s][i.Nt+h]=i.oi;let h=this.ai(s);return{hi:t,yi:this.li(t,h),ci:this.ni(t,Math.random),ei:h}}},b={32:3,44:3,46:3,73:2},g={async init(){this.default=n.font.q,this.xi=this.fi(this.default,t=>{let s=t.createLinearGradient(0,0,0,this.default.height);return s.addColorStop(0,"rgba(240,134,51,1)"),s.addColorStop(1,"rgba(250,220,74,1)"),s}),this.wi=this.fi(this.default,"rgba(240, 240, 255, 0.25)")},ui(t,s,i,h,e=this.default,r=1){s=s.toUpperCase();for(let a=0;a<s.length;a++){let o=s.charCodeAt(a);t.drawImage(e,4*(o-32),0,3,5,i,h,3*r,5*r),i+=(b[o]||4)*r}},Mi(t,s,i,h,e=this.default,r=1){s=s.toUpperCase(),i-=this.di(s,r),this.ui(t,s,i,h,e,r)},mi(t,s,i,h,e,r,a=this.default,o=1){let l=i,n=h,y=s.toUpperCase().split(" ");for(let s of y){let h=this.di(s,o);l+h-i>e&&(l=i,n+=7*o),this.ui(t,s,l,n,a,o),l+=h+b[32]}},di:(t,s)=>t.split("").reduce((t,s)=>t+(b[s.charCodeAt(0)]||4),0)*s,fi(t,s){let i=new o(t.width,t.height);return i.t.fillStyle="function"==typeof s?s(i.t):s,i.t.fillRect(0,0,t.width,t.height),console.log(t.width,t.height,s,i),i.t.globalCompositeOperation="destination-in",i.t.drawImage(t,0,0),i.canvas}},N={gi(t,s){for(let i of M.Pt(t.Rt,s.Rt))if(!M.ti(i.Nt,i.r))return!1;return!0}},p={IDLE:101,pi:102,bi:103,vi:104,ki:105,Ei:106,$:201,nt:202,apply(t){for(let s of t)s.Ai&&s.Ai()}};class k{constructor(){this.Rt={x:0,y:0},this.Bi={x:0,y:0},this.Ti={x:0,y:-1,ot:0},this.Di=100,this.Si=[],this.qi=11,this.Hi=.5}Ai(){switch(this.state){case p.IDLE:N.gi(this,_.Ni)&&(this.state=p.bi);break;case p.bi:let t=M.bt(this.Rt,_.Ni.Rt);t.ot=M.Lt(t.ot,0,1),this.Bi={x:t.x*t.ot,y:t.y*t.ot};break;case p.Ei:this.Bi={x:0,y:0,ot:0},this.Ci||(this.Ci=15),this.Ci--,this.Ci<1&&(this.Ii=!0);break;default:this.state=p.IDLE}}Ri(t){this.state===p.Ei?n.H(t,n.Oi,this.Rt,_.Ot.Rt):n.H(t,n.Li,this.Rt,_.Ot.Rt)}}class m{constructor(t,s){this.Rt={...t},this.angle=s,this.Fi=M.gt[70],this.range=55}Ai(){if(this._t=(this._t||0)+1,3===this._t){let t=_.entities.filter(t=>t.Di&&!(t instanceof R));for(let s of t){let t=M.bt(this.Rt,s.Rt);if(t.ot>=this.range+s.qi)continue;let i=M.bt(this.Rt,{x:s.Rt.x-t.y*s.qi,y:s.Rt.y+t.x*s.qi}),h=M.bt(this.Rt,{x:s.Rt.x+t.y*s.qi,y:s.Rt.y-t.x*s.qi}),e=[M.kt(i),M.kt(h)];if(!M.qt(e[0],e[1],this.angle-this.Fi/2,this.angle+this.Fi/2))continue;let r=[];M.Bt(this.Rt,M.vt(e[0],t.ot));for(let s of M.Ut(this.Rt,M.vt(e[0],t.ot)))if(!M.ti(s.Nt,s.r)){r.push(s);break}for(let s of M.Ut(this.Rt,M.vt(e[1],t.ot)))if(!M.ti(s.Nt,s.r)){r.push(s);break}r.length<2&&s.Si.push({Pi:100,Ui:t,Vi:9})}}this._t>6&&(this.Ii=!0)}Ri(t){let s=M.It(this.Rt);t.t.beginPath(),t.t.arc(s.N,s.C,this.range,this.angle-this.Fi/2,this.angle+this.Fi/2),t.t.lineTo(s.N,s.C),t.t.closePath(),t.t.fillStyle="rgba(255, 0, 0, 0.5)",t.t.fill()}}class A{constructor(t){this._t=-1,this.d=t,this.z=101}Ai(){++this._t===this.d&&(this.Ii=!0)}Ri(t){for(let s=0;s<_.Ni.Wi;s++){let i=s*this.d/_.Ni.Wi,h=i-3;if(this._t>=h){let h=Math.min(10,10+this._t-i);t.t.globalAlpha=Math.min(1,1+(this._t-i)/10),t.t.drawImage(n.zi.q,15+6*s,h),t.t.globalAlpha=1}}}}const v=new(top.AudioContext||webkitAudioContext),$={async init(){var t;$.Gi=(t=[,.01,140,.01,.02,.45,4,2.42,.1,-.1,,,,1.2,,.3,.04,.8,.02],((t=1,s=.05,i=220,h=0,e=0,r=.1,a=0,o=1,l=0,n=0,y=0,f=0,c=0,x=0,w=0,M=0,u=0,d=1,b=0,g=44100,N=99+h*g,p=e*g,k=r*g,m=b*g,A=u*g,v=2*Math.PI,$=(t=>0<t?1:-1),R=N+m+p+k+A,j=(l*=500*v/g**2),T=(i*=(1+2*s*Math.random()-s)*v/g),C=$(w)*v/4,E=0,I=0,J=0,_=0,K=0,Q=0,S=1,D=[])=>{for(;J<R;D[J++]=Q)++K>100*M&&(K=0,Q=E*i*Math.sin(I*w*v/g-C),Q=$(Q=a?1<a?2<a?3<a?Math.sin((Q%v)**3):Math.max(Math.min(Math.tan(Q),1),-1):1-(2*Q/v%2+2)%2:1-4*Math.abs(Math.round(Q/v)-Q/v):Math.sin(Q))*Math.abs(Q)**o*t*.3*(J<N?J/N:J<N+m?1-(J-N)/m*(1-d):J<N+m+p?d:J<R-A?(R-J-A)/k*d:0),Q=A?Q/2+(A>J?0:(J<R-A?1:(J-R)/A)*D[J-A|0]/2):Q),E+=1-x+1e9*(Math.sin(J)+1)%2*x,I+=1-x+1e9*(Math.sin(J)**2+1)%2*x,i+=l+=500*n*v/g**3,S&&++S>f*g&&(i+=y*v/g,T+=y*v/g,S=0),c&&++_>c*g&&(i=T,l=j,_=1,S=S||1);return D})(...t))},_i(){((...t)=>{let s=v.createBufferSource(),i=v.createBuffer(t.length,t[0].length,44100);t.map((t,s)=>i.getChannelData(s).set(t)),s.buffer=i,s.connect(v.destination),s.start()})($.Gi)}};class R{constructor(){this.Rt={x:0,y:0},this.Bi={x:0,y:0},this.Ti={x:0,y:-1,ot:0},this.Di=100,this.Si=[],this.qi=12,this.ji=4,this.Wi=4,this.Hi=3}Ai(){switch(this.state){case p.vi:this.$i(1),_.input.pressed[w.K.$]&&(0===this.ji?this.reload():this.xi()),_.input.pressed[w.K.nt]&&this.reload();break;case p.$:this.$i(1),--this.c<=0&&(this.state=p.vi);break;case p.nt:this.$i(2.5),--this.c<=0&&(this.ji=this.Wi,this.state=p.vi);break;default:this.state=p.vi,this.c=0}}$i(t){_.Ki()&&(this.Ti=M.bt(this.Rt,_.Ki()));let s=_.input.f.x*_.input.f.ot*1.8*t,i=_.input.f.y*_.input.f.ot*1.8*t;this.Bi.x=(this.Bi.x+s)/2,this.Bi.y=(this.Bi.y+i)/2}xi(){$._i(),this.state=p.$,this.c=6,this.ji--;let t=M.kt(this.Ti);_.entities.push(new m(this.Rt,t)),this.Bi=M.Et({...M.pt(this.Ti),ot:-1})}reload(){this.state=p.nt,this.c=12,_.entities.push(new A(this.c))}Ri(t){n.H(t,n.Ni,this.Rt,_.Ot.Rt),t.t.strokeStyle="rgba(255, 255, 64, 0.3)",t.t.beginPath();let s=_.It(this.Rt);t.t.arc(s.N,s.C,9,0,2*Math.PI),t.t.setLineDash([2,1]),t.t.stroke(),t.t.setLineDash([])}}class j{constructor(){this.Rt={x:0,y:0},this.Bi={x:0,y:0},this.Ti={x:0,y:-1,ot:0},this.Di=100,this.Si=[],this.qi=3,this.Hi=1,this.Ji=!0}Ai(){switch(this.state){case p.IDLE:let h=Math.random()*e;h%i<t&&(h+=t),h%i>s&&(h-=t),this.Ti=M.vt(h),this.Bi=this.Ti,this.state=p.bi;break;case p.bi:M.kt(M.bt(this.Rt,_.Ni.Rt)),M.kt(this.Bi);let r=M.pt(this.Bi);r.ot=(r.ot+2.5)/2,this.Bi=M.Et(r);let a=M.bt(this.Rt,_.Ni.Rt);a.ot<=this.qi+_.Ni.qi&&_.Ni.Si.push({Pi:5,Ui:a,Vi:3});break;case p.Ei:this.Bi={x:0,y:0,ot:0},this.Ci||(this.Ci=15),this.Ci--,this.Ci<1&&(this.Ii=!0);break;default:this.state=p.IDLE}}Ri(t){if(this.state===p.Ei)n.H(t,n.Oi,this.Rt,_.Ot.Rt);else{let{N:s,C:i}=n.I(t,n.k,this.Rt,_.Ot.Rt);s+=n.k.e.x,i+=n.k.e.y,t.t.save(),t.t.translate(s,i),t.t.rotate(_.b/5),n.S(t.t,n.k,0,0),t.t.restore(),n.S(t.t,n.Xi,s,i)}}}const T={Ri(t){}};class C{constructor(t){this._t=-1,this.d=16,this.z=-5,this.Rt=t}Ai(){++this._t===this.d&&(this.Ii=!0)}Ri(t){if(this._t>=0&&this._t<16){let s=Math.floor(this._t/2);n.H(t,n.i[s],{x:this.Rt.x,y:this.Rt.y+s},_.Ot.Rt)}}}const E={apply(t){let s=t.filter(t=>t.Rt&&t.Bi&&!t.Ii);for(let t=0;t<5;t++){for(let t=0;t<s.length-1;t++)for(let i=t+1;i<s.length;i++)this.Yi(s[t],s[i]);for(let t of s)this.Zi(t)}for(let t of s)t.Rt.x+=t.Bi.x,t.Rt.y+=t.Bi.y},Yi(t,s){let i=M.Xt(t.Rt,t.qi,t.Bi,s.Rt,s.qi,s.Bi);if(i)if(t.Ji&&s.Ji)t.Bi.x=-i.jt*i.ot,t.Bi.y=-i.$t*i.ot,s.Bi.x=i.jt*i.ot,s.Bi.y=i.$t*i.ot;else{let h=M.pt(t.Bi).ot+s.Hi,e=M.pt(s.Bi).ot+t.Hi,r=t.Ji?.1:1,a=s.Ji?.1:1;t.Bi.x-=i.jt*i.ot*r*h/(h+e),t.Bi.y-=i.$t*i.ot*r*h/(h+e),s.Bi.x+=i.jt*i.ot*a*e/(h+e),s.Bi.y+=i.$t*i.ot*a*e/(h+e)}},Zi(t){for(let s of M.zt(t.Rt,t.Bi,t.qi))if(!M.ti(s.Nt,s.r)){let i=[M.Ct(s),M.Ct({Nt:s.Nt+1,r:s.r+1})],h=M.Gt(t.Rt,{x:t.Rt.x+t.Bi.x,y:t.Rt.y+t.Bi.y},t.qi,i);h&&(t.Ji?0===h.jt?t.Bi.y=-t.Bi.y:0===h.$t?t.Bi.x=-t.Bi.x:(t.Bi.x+=h.jt,t.Bi.y+=h.$t):0===h.jt?t.Bi.y=h.y-t.Rt.y:0===h.$t?t.Bi.x=h.x-t.Rt.x:(t.Bi.x+=h.jt,t.Bi.y+=h.$t))}}};class I{constructor(t,s){this.start=t,this.Pi=s,this._t=-1,this.d=20,this.z=101,this.y=5,this.Bi=-.7,this.Qi=.09}Ai(){++this._t===this.d&&(this.Ii=!0),this.y+=this.Bi,this.Bi+=this.Qi}Ri(t){let s=this.start-this.Pi+8;this._t>15&&(t.t.globalAlpha=1-.1*this._t),t.t.drawImage(n.ts.q,s,3,this.Pi,3,s+2,this.y,this.Pi,3),t.t.globalAlpha=1}}const J={apply(t){for(let s of t)if("number"==typeof s.Di){if(s.Si.length>0){for(let t of s.Si)s instanceof R&&_.entities.push(new I(s.Di,t.Pi)),s.Di-=t.Pi,t.Ui.ot=t.Vi,s.Bi=M.Bt(s.Bi,t.Ui);s.Si=[]}s.Di<=0&&(s.state=p.Ei)}}},_=new class{constructor(){}async init(){c.init(),this.input=new w,await this.input.init(),await $.init(),this.hi=d.load(),this.Ot={Rt:{x:1,y:1}},await class{static async init(){this.images={},await this.ss("sprites.png"),n.font=this.hs(l.font[0]),n.Ni=this.hs(l.v[0]),n.h=this.hs(l.h[0]),n.Li=this.hs(l.m[0]),n.Oi=this.hs(l.m[0]),n.es=this.hs(l.u[0]),n.zi=this.hs(l.u[1]),n.rs=this.hs(l.l[0]),n.as=this.hs(l.l[1]),n.ts=this.hs(l.l[2]),n.o=this.hs(l.o[0]),n.k=this.hs(l.k[0]),n.Xi=this.hs(l.k[1]),n.page=await this.hs(l.page[0]),n.i=l.i.map(t=>this.hs(t)),n.os=l.D.slice(4,7).map(t=>this.hs(t)),n.ls=l.D.slice(1,4).map(t=>this.hs(t)),n.ci=[],n.ci[0]=this.hs(l.T[2]),n.ci[2]=this.hs(l.T[0]),n.ci[3]=this.hs(l.T[1]),n.yi=this.hs(l.D[0]),n.ns=this.ys(this.cs())}static hs(t,s){return this.ys(this.xs("sprites.png",t.x,t.y,t.w,t.s),s)}static fs(t,s){let i=new o(t.width,t.height);return i.t.translate(t.width/2,t.height/2),i.t.rotate(s),i.t.translate(-t.width/2,-t.height/2),i.t.drawImage(t,0,0),i.canvas}static ws(...t){let s=new o(t[0].width,t[0].height);for(let i of t)s.t.drawImage(i,0,0);return s.canvas}static ys(t,s){let i=t.width,h=t.height;return{q:t,e:s&&s.e||{x:Math.floor(i/2),y:Math.floor(h/2)},L:s&&s.L||[{x:0,y:0},{x:i,y:h}],P:s&&s.P}}static xs(t,s,i,h,e){const r=this.images[t],a=new o(h,e);return a.t.drawImage(r,s,i,h,e,0,0,h,e),a.canvas}static async ss(t){return this.images[t]?this.images[t]:await new Promise((s,i)=>{let h=new Image;h.onload=()=>s(h),h.onerror=t=>i(t),h.src=t,this.images[t]=h})}static cs(){let t=new o(500,300),s=t.t.createLinearGradient(0,0,0,270);s.addColorStop(0,"rgba(128,20,20,1)"),s.addColorStop(1,"rgba(191,31,31,1)"),t.t.fillStyle=s,t.t.fillRect(0,0,500,300);for(let s=0;s<500;s++)t.t.clearRect(s,299-20*Math.random(),3,30);return t.canvas}}.init(),await g.init(),this.entities=[],this.Ni=new R,console.log(this.hi.ei),this.Ni.Rt.x=(this.hi.ei[1].Nt+Math.floor(this.hi.ei[1].w/2))*r+16,this.Ni.Rt.y=(this.hi.ei[1].r+Math.floor(this.hi.ei[1].s/2))*r+16,this.entities.push(this.Ni),this.us=[]}start(){this.b=0,this.Ms=!0,this.n(),this.Ms=!1,window.requestAnimationFrame(()=>this.ds(1))}ds(t){this.b++,c.resize(),this.n(),this.Ri(c.t),window.requestAnimationFrame(()=>this.ds(t))}n(){this.input.n(),p.apply(this.entities),J.apply(this.entities),E.apply(this.entities),this.entities=this.entities.filter(t=>!t.Ii);let t=this.Ni.Rt.x-this.Ot.Rt.x,s=this.Ni.Rt.y-this.Ot.Rt.y;if(this.Ot.Rt.x+=.2*t,this.Ot.Rt.y+=.2*s,!this.ii){let t=M.Ht(_.Ni.Rt),s=this.hi.ei[this.hi.hi[t.r][t.Nt]];console.log(this.hi.hi[t.r][t.Nt]),console.log(s),s&&s.oi>=3&&!this.us.includes(s.oi)&&s.w>=3&&s.s>=4&&t.Nt>s.Nt&&t.r>s.r&&t.Nt<s.Nt+s.w-1&&t.r<s.r+s.s-1&&(this.ii={si:s,ms:[],start:this.b,gs:[{b:this.b+10,x:Math.floor(Math.random()*(32*s.w))+32*s.Nt,y:Math.floor(Math.random()*(32*s.s))+32*s.r},{b:this.b+50,x:Math.floor(Math.random()*(32*s.w))+32*s.Nt,y:Math.floor(Math.random()*(32*s.s))+32*s.r},{b:this.b+90,x:Math.floor(Math.random()*(32*s.w))+32*s.Nt,y:Math.floor(Math.random()*(32*s.s))+32*s.r}]},console.log("BATTLE STARTED",s))}if(this.ii)if(0===this.ii.gs.length)0===this.ii.ms.filter(t=>!t.Ii).length&&(this.us.unshift(this.ii.si.oi),this.ii=void 0,console.log("BATTLE FINISHED",this.ps));else if(this.b>=this.ii.gs[0].b){let t=this.ii.gs.shift(),s=new j;s.Rt={x:t.x,y:t.y},this.entities.push(s),this.ii.ms.push(s)}let i=Math.floor(530*Math.random())-25,h=Math.floor(320*Math.random())-25,e=this.bs({N:i,C:h});this.entities.push(new C(e))}vs(){if(this.entities.filter(t=>t instanceof k).length<4&&Math.random()<.1){let t=this.hi.ei[1][0].Nt+this.hi.ks(0,this.hi.ei[1][0].width),s=this.hi.ei[1][0].r+this.hi.ks(0,this.hi.ei[1][0].height),i=new k;i.Rt=M.Ct({Nt:t,r:s}),this.entities.push(i)}}Ri(t){if(t.setTransform(1,0,0,1,0,0),t.scale(c.scale,c.scale),t.fillStyle="rgba(20,20,20,1)",t.fillRect(0,0,c.width,c.height),this.ii){t.fillStyle="rgba(128,20,20,1)";let s=Math.min(0,8*(this.b-this.ii.start)-300);t.drawImage(n.ns.q,0,s)}for(let t of this.entities)t.z<0&&t.Ri(c);this.Es(t,this.hi);for(let t of this.entities)(t.z>0||!t.z)&&t.Ri(c);this.As(t);let s=this.b;g.ui(t,"FIGHT",10*s,100,g.wi,4),g.ui(t,"FIGHT",10*s,100,g.default,4);for(let t of this.entities)t.z&&t.z>100&&t.Ri(c);T.Ri(c)}Es(t,s){let i=c.R.N-this.Ot.Rt.x,h=c.R.C-this.Ot.Rt.y,e=this.ii?this.ii.si.r:0,r=this.ii?this.ii.si.r+this.ii.si.s:s.ci.length,a=this.ii?this.ii.si.Nt:0,o=this.ii?this.ii.si.Nt+this.ii.si.w:s.ci[0].length;for(let l=e;l<r;l++)for(let e=a;e<o;e++){let r=32*e+i,a=32*l+h;if(r<-50||a<-50||r>500||a>500)continue;let o=n.ci[15&s.ci[l][e]];if(!o)throw new Error(`${e},${l} tile ${s.ci[l][e]}`);t.drawImage(o.q,r,a)}for(let l=e;l<r;l++)for(let r=a;r<o;r++){let y=32*r+i,f=32*l+h;if(!(y<-50||f<-50||y>500||f>500)&&(8&s.yi[l][r]&&t.drawImage(n.yi.q,5,5,36,4,y-2,f-2,36,4),4&s.yi[l][r]&&t.drawImage(n.yi.q,37,5,4,36,y+30,f-2,4,36),2&s.yi[l][r]&&t.drawImage(n.yi.q,5,37,36,4,y-2,f+30,36,4),1&s.yi[l][r]&&t.drawImage(n.yi.q,5,5,4,36,y-2,f-2,4,36),this.ii)){let i=this.b/8%3|0;128&s.yi[l][r]?t.drawImage(n.ls[i].q,5,0,36,9,y-2,f-7,36,9):l===e&&t.drawImage(n.os[i].q,5,0,36,5,y-2,f-7,36,5),64&s.yi[l][r]?t.drawImage(n.ls[i].q,37,5,9,41,y+30,f-2,9,41):l===e&&r===o-1&&t.drawImage(n.os[i].q,41,0,5,46,y+34,f-7,5,46),32&s.yi[l][r]&&t.drawImage(n.ls[i].q,5,37,36,9,y-2,f+30,36,9),16&s.yi[l][r]?t.drawImage(n.ls[i].q,0,5,9,41,y-7,f-2,9,41):l===e&&r===a&&t.drawImage(n.os[i].q,0,0,5,46,y-7,f-7,5,46)}}}Ki(){if(this.input.yt)return this.bs(this.input.yt)}It(t){return{N:t.x-this.Ot.Rt.x+c.R.N,C:t.y-this.Ot.Rt.y+c.R.C}}bs(t){return{x:t.N-c.R.N+this.Ot.Rt.x,y:t.C-c.R.C+this.Ot.Rt.y}}As(t){let s=M.Lt(_.Ni.Di,0,100);t.drawImage(n.rs.q,2,2),t.drawImage(n.as.q,0,0,s+8,8,2,2,s+8,8);let i=n.zi;for(let s=0;s<_.Ni.Wi;s++)s+1>_.Ni.ji&&(i=n.es),t.drawImage(i.q,15+6*s,10);t.drawImage(n.page.q,c.width-39,9),g.ui(t,"x302",c.width-30,10),g.ui(t,String(this.b),c.width-30,c.height-28),g.Mi(t,[c.scale,c.width,c.height].join(", "),c.width-4,c.height-18);let h=this.input.yt;if(h&&(g.Mi(t,JSON.stringify(h),c.width-4,c.height-8),t.save(),t.translate(h.N,h.C),t.rotate(this.b/72),t.drawImage(n.o.q,-n.o.e.x,-n.o.e.y),t.restore()),!this.Bs){let t=["rgba(20, 20, 20)","rgba(20, 20, 20)","rgba(32, 32, 32)","rgba(32, 32, 32)","rgba(64, 6, 6)","rgba(64, 6, 6)","rgba(128, 0, 0)","rgba(158, 32, 32)"];this.Bs=new o(100,100);for(let s=0;s<100;s++)for(let i=0;i<100;i++){let h=t[Math.floor(Math.random()*t.length)];this.Bs.t.fillStyle=h,this.Bs.t.fillRect(s,i,1,1)}this.Bs.t.Ts=.1,this.Bs.t.drawImage(this.Bs.canvas,0,0,50,100,1,0,50,100),this.Bs.t.drawImage(this.Bs.canvas,0,0,50,100,2,0,50,100),this.Bs.t.drawImage(this.Bs.canvas,0,0,50,100,3,0,50,100)}this.b}};_.init().then(()=>_.start())}();
//# sourceMappingURL=app.js.map</script>